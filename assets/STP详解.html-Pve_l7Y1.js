import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as l,o}from"./app-CRBxQhNH.js";const p="/wsq-blog/assets/1-C0Tztn_M.png",e="/wsq-blog/assets/2-DIaP69xv.png",t="/wsq-blog/assets/3-D5-uW7kP.png",F="/wsq-blog/assets/4-DPA7IP8k.png",c="/wsq-blog/assets/5-CWJfVpz3.png",r="/wsq-blog/assets/6-HiA1x-Pe.png",D="/wsq-blog/assets/7-8071cwmn.png",y="/wsq-blog/assets/8-DxIerdob.png",i="/wsq-blog/assets/9-DXZNsHXv.png",C="/wsq-blog/assets/10-DcGEcuy-.png",A="/wsq-blog/assets/11-gUV0d_9j.png",d="/wsq-blog/assets/12-o0KGVcRA.png",g="/wsq-blog/assets/13-BGpS0SB4.png",B="/wsq-blog/assets/14-DXhlH-gw.png",P="/wsq-blog/assets/15-BC6Sy81C.png",h="/wsq-blog/assets/16-fJq9voLn.png",f="/wsq-blog/assets/18-sPo-oAOr.png",T="/wsq-blog/assets/19-D_FT_y6-.png",S="/wsq-blog/assets/20-b5Zc_I5j.png",b="data:image/png;base64,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",u="/wsq-blog/assets/23-BpPZmEJI.png",m="/wsq-blog/assets/25-C9811l4J.png",v="/wsq-blog/assets/26-ClApOGZ9.png",R="/wsq-blog/assets/27-igrMSEKk.png",I="/wsq-blog/assets/28-DUeRCjau.png",x="/wsq-blog/assets/29-DSewc7_Q.png",U="/wsq-blog/assets/30-BGsQWq9X.png",M="/wsq-blog/assets/31-DfOxSVmB.png",N="/wsq-blog/assets/32-C7JL9YKd.png",k="/wsq-blog/assets/33-Dz8VWTs3.png",E="/wsq-blog/assets/34-DHX0iGx0.png",G="/wsq-blog/assets/37-BQAJQ9Ge.png",w="/wsq-blog/assets/38-DDbiQJHI.png",W="/wsq-blog/assets/39-CHw1dXL0.png",z="/wsq-blog/assets/49-COUxVH-8.png",H={};function O(q,s){return o(),a("div",null,s[0]||(s[0]=[l('<h2 id="网络环路" tabindex="-1"><a class="header-anchor" href="#网络环路"><span>网络环路</span></a></h2><p>网络通信中，通常是以一条链路能够正常工作为前提，如果链路断开或节点故障，那么互联的设备就无法正常通信了，这类网络问题叫做单点故障。没有备份的链路或节点，出现故障会直接断网。</p><figure><img src="'+p+'" alt="单点故障" tabindex="0" loading="lazy"><figcaption>单点故障</figcaption></figure><p>如果要提供 24 小时不间断的服务，那就需要在网络中提前部署冗余。避免出现单点故障，合理的做法是在网络中的关键设备和关键链路添加冗余。在冗余的网络环境中，任意一条链路发生故障断开，都不会影响网络，直接使用其它链路继续转发数据，解决单点故障的隐患。</p><figure><img src="'+e+'" alt="冗余链路" tabindex="0" loading="lazy"><figcaption>冗余链路</figcaption></figure><p>但同时也带来了另外的网络问题。这种组网会构成二层环路，会引发广播风暴、重复帧、MAC 地址漂移等问题，严重时会占满链路带宽，或打爆设备 CPU，导致设备无法正常工作，最终造成网络瘫痪。当然，在实际的网络中，不少二层环路是由于人为的错误操作导致的，比如接错了网线。</p><figure><img src="'+t+'" alt="二层环路" tabindex="0" loading="lazy"><figcaption>二层环路</figcaption></figure><p>举个栗子：大刘的主机想要与小美的主机进行通信，现在只知道小美主机的 IP 地址，不知道 MAC 地址。有 IP 地址，就可以通过 ARP 协议来获取小美主机的 MAC 地址。我们来看看有冗余的网络中数据交换的过程：</p><figure><img src="'+F+'" alt="冗余网络" tabindex="0" loading="lazy"><figcaption>冗余网络</figcaption></figure><ol><li>大刘主机向交换机 A 发送 ARP 广播帧，来解析小美主机的 MAC 地址；<br><img src="'+c+'" alt="主机发送广播帧" loading="lazy"></li><li>交换机 A 收到广播帧后，查看自己的 MAC 地址表，没找到相应的表项，就向所有端口（除接收端口之外）泛洪这个广播帧。也就是向<code>G0/1</code>和<code>G0/2</code>两个端口泛洪广播帧；<br><img src="'+r+'" alt="广播帧泛洪" loading="lazy"></li><li>交换机 B 和交换机 C 收到广播帧后，没有对应 MAC 地址表项，也将广播帧所有端口（除接收端口之外）泛洪出去；<br><img src="'+D+'" alt="广播帧泛洪" loading="lazy"></li><li>小美主机终于收到了大刘发送的 ARP 广播帧，发现是查询自己的 MAC 地址后，小美主机将会通过单播帧返回自己的 MAC 地址；<br><img src="'+y+'" alt="主机发送单播帧" loading="lazy"></li><li>这个过程看似正常，大刘主机发送的 ARP 广播帧顺利到达小美主机，小美主机也进行了响应，但是网络中广播帧的传输还没有结束。在第 3 步中，交换机 C 也把 ARP 广播帧泛洪到交换机 B 。这时交换机 B 就收到了两个相同的 ARP 广播帧，分别来自交换机 A 和交换机 C，收到的广播帧都会泛洪出去。那么，小美主机也会收到两个相同的 ARP 广播帧，也就是重复帧。出现这种现象说明网络中存在不合理的冗余链路；<br><img src="'+i+'" alt="重复帧" loading="lazy"></li><li>接下来我们看下交换机 C，交换机 C 收到从交换机 A 发过来的广播帧，同时交换机 C 的 MAC 地址表添加一条表项，记录大刘主机 MAC 地址和端口<code>G0/0</code>的映射关系。交换机 C 又从交换机 B 收到相同的广播帧，大刘主机 MAC 地址的映射端口从<code>G0/0</code>变成<code>G0/1</code>。从不同的端口收到相同的数据帧，导致 MAC 地址表项发生变化的现象，就叫做 MAC 地址漂移，这种现象说明网络中可能存在环路。这样一来，交换机 C 就无法确定大刘主机到底位于自己的哪个端口；<br><img src="'+C+'" alt="MAC地址漂移" loading="lazy"></li><li>主机收到广播帧，会进行解封装，查看上层的 IP 地址是否是发送给自己的，再进行下一步处理。交换机（只指二层交换机）收到广播帧，会直接进行泛洪。大刘主机发出的广播帧，经过交换机 A 后，从交换机 A 的<code>G0/1</code>口泛洪的广播帧，交换机 B 收到后再从<code>G0/2</code>口进行泛洪，交换机 C 收到广播帧后，又从<code>G0/0</code>口泛洪出去，结果广播帧回到了交换机 A，交换机 A 再从<code>G0/1</code>进行泛洪，最终这个广播帧会一直逆时针、永无止境的进行泛洪；同理，交换机 A 从<code>G0/2</code>口进行泛洪的广播帧，也会按顺时针、无休止的在三台交换机上进行泛洪。这种广播帧不停泛洪的现象，叫做广播风暴。广播风暴不仅会大量消耗网络设备的带宽和 CPU 使用率，也会影响到主机。主机收到一个广播帧后，会解封装上送网络层去处理，大量的广播帧泛洪，很可能导致主机瘫痪。</li></ol><figure><img src="'+A+'" alt="广播风暴" tabindex="0" loading="lazy"><figcaption>广播风暴</figcaption></figure><p>通过这个演示，我们看到了冗余链路带来的风险。重复帧、MAC 地址漂移和广播风暴，都是由一个广播帧引起的，可是网络中不可避免出现广播帧，也不能因为二层环路问题而忽略冗余链路增加网络可靠性的好处。</p><p>那么如何在保证网络冗余的情况下，消除二层环路呢？实际上交换机的二层环路是一个典型问题，解决方案也有不少。其中的一个解决方案就是 STP（生成树协议），能够阻断冗余链路来消除可能存在的环路，并且在网络故障时激活被阻断的冗余备份链路，恢复网络的连通性，保障业务的不间断服务。</p><figure><img src="'+d+'" alt="STP解决环路问题" tabindex="0" loading="lazy"><figcaption>STP解决环路问题</figcaption></figure><p>当网络中部署了 STP 后，交换机之间会交互相关协议报文，并计算出一个无环路的网络拓扑。当网络存在环路时，STP 会将网络中的一个或多个接口进行阻塞，将环路网络结构修剪成无环路的树状网络结构。被阻塞的接口不再转发数据，这样二层环路问题便迎刃而解。STP 会持续监控网络拓扑状况，当网络拓扑发生变化时，STP 能够及时感知，并动态调整被阻塞接口，而无需人工干预。</p><figure><img src="'+g+'" alt="STP修复网络故障" tabindex="0" loading="lazy"><figcaption>STP修复网络故障</figcaption></figure><h2 id="stp-基本概念" tabindex="-1"><a class="header-anchor" href="#stp-基本概念"><span>STP 基本概念</span></a></h2><p>STP 是用在局域网中消除数据链路层物理环路的协议，标准名称是<code>802.1D</code>。</p><p>STP 带来的好处有：</p><ul><li>消除环路：STP 可以通过阻塞冗余端口，确保网络无环且连通；</li><li>链路备份：当使用的链路因故障断开时，可以检测到这种情况，并自动开启阻塞状态的冗余端口，网络迅速恢复正常。</li></ul><p>在了解 STP 的原理之前，我们先来看看几个专业术语：</p><h3 id="桥-id-bridge-id-bid" tabindex="-1"><a class="header-anchor" href="#桥-id-bridge-id-bid"><span>桥 ID（Bridge ID，BID）</span></a></h3><p>在 STP 里使用不同的桥 ID 标识不同的交换机。每一台运行 STP 的交换机都有一个唯一的桥 ID。桥 ID 一共 8 字节，包含 2 字节的桥优先级和 6 字节的桥 MAC 地址。桥优先级的值可以人为设定，默认值是 32768。桥 MAC 地址通常是交换机默认<code>VLAN1</code>的 MAC 地址。</p><figure><img src="'+B+'" alt="BID" tabindex="0" loading="lazy"><figcaption>BID</figcaption></figure><h3 id="根桥-root-bridge-rb" tabindex="-1"><a class="header-anchor" href="#根桥-root-bridge-rb"><span>根桥（Root Bridge，RB）</span></a></h3><p>STP 要在整个二层网络中计算出一棵无环的“树”，树形成了，网络中的无环拓扑也就形成了。其中最重要的就是树根，树根明确了，“树枝”才能沿着网络拓扑进行延伸。STP 的根桥就是这棵树的树根。当 STP 启动后，第一件事就是在网络中选举出根桥。在一个二层网络中，根桥只有一个，其余设备都是非根桥。当网络的拓扑发生变化时，根桥也可能会发生变化。</p><figure><img src="'+P+'" alt="根桥ID" tabindex="0" loading="lazy"><figcaption>根桥ID</figcaption></figure><p>网络中桥 ID 最小的交换机将成为根桥。在比较桥 ID 大小时，首先比较的是桥优先级，桥优先级的值<strong>最小</strong>的交换机选为根桥；如果桥优先级相同，那么会比较 MAC 地址，MAC 地址<strong>最小</strong>的交换机选为根桥。</p><figure><img src="'+h+'" alt="根桥交换机" tabindex="0" loading="lazy"><figcaption>根桥交换机</figcaption></figure><h3 id="根路径开销-root-path-cost-rpc" tabindex="-1"><a class="header-anchor" href="#根路径开销-root-path-cost-rpc"><span>根路径开销（Root Path Cost，RPC）</span></a></h3><p>STP 交换机每一个端口都对应一个开销值，这个值表示数据通过端口发送时的开销，这个值与端口带宽有关，带宽越高，开销值越小。对于端口开销值的定义有不同的标准，通常设备默认使用<code>IEEE 802.1t</code>中定义的开销值，同时还支持其它标准，以便兼容不同厂家的设备。</p><p><code>Cost</code>值标准对比表：</p><table><thead><tr><th>接口速率</th><th>IEEE 802.1D</th><th>IEEE 502.1t</th><th>私有标准</th></tr></thead><tbody><tr><td>10Mbps</td><td>100</td><td>2000000</td><td>2000</td></tr><tr><td>100Mbps</td><td>19</td><td>200000</td><td>200</td></tr><tr><td>1Gbps</td><td>4</td><td>20000</td><td>20</td></tr><tr><td>10Gbps</td><td>2</td><td>2000</td><td>2</td></tr><tr><td>40Gbps</td><td>1</td><td>500</td><td>1</td></tr></tbody></table><p>非根桥到达根桥可能有多条路径，每条路径都有一个总开销值，也就是根路径开销（RPC），这个值是通过这条路径所有<strong>出端口</strong>的开销值累加而来的。STP 不会计算入端口的开销，只在数据通过端口发出时，才计算这个端口的开销。对于根桥来说，根路径开销是 0。</p><figure><img src="'+f+'" alt="计算根路径开销" tabindex="0" loading="lazy"><figcaption>计算根路径开销</figcaption></figure><h3 id="端口-id-port-id-pid" tabindex="-1"><a class="header-anchor" href="#端口-id-port-id-pid"><span>端口 ID（Port ID，PID）</span></a></h3><p>运行 STP 的交换机使用端口 ID 标识每个端口，端口 ID 主要用于选举指定端口。端口 ID 长度为 16 比特，其中前 4 比特是端口优先级，后 12 比特是端口编号。在进行比较时，先比较端口优先级，<strong>优先级小</strong>的端口优先；在优先级相同时，再比较端口编号，<strong>编号小</strong>的端口优先。通常情况下，<strong>端口编号无法改变</strong>，可通过设置端口优先级来影响生成树的选路。</p><figure><img src="'+T+'" alt="端口ID" tabindex="0" loading="lazy"><figcaption>端口ID</figcaption></figure><h3 id="bpdu" tabindex="-1"><a class="header-anchor" href="#bpdu"><span>BPDU</span></a></h3><p>STP 协议使用 BPDU 报文进行交互，BPDU 包含与 STP 协议相关的所有信息，并且使用这些信息来完成生成树的计算。BPDU 是组播帧，地址为<code>0180-c200-0000</code>，并由 STP 交换机产生、发送、接收、处理，终端主机不参与。BPDU 分为两种类型：</p><ol><li>配置 BPDU（<code>Configuration BPDU</code>）：在 STP 的初始化过程中，每台交换机都会产生并发送配置 BPDU。在 STP 树形成后的稳定期，只有根桥才会周期性地发送配置 BPDU；相应的，非根桥会从自己的根端口收到配置 BPDU，并更新自己的配置 BPDU，再从指定端口发送出去。这个过程看起来像根桥发出的配置 BPDU 逐跳的经过了其它交换机。</li></ol><figure><img src="'+S+'" alt="Configuration BPDU 格式" tabindex="0" loading="lazy"><figcaption>Configuration BPDU 格式</figcaption></figure><p>配置 BPDU 的参数：</p><table><thead><tr><th>字段</th><th>字节数</th><th>描述</th></tr></thead><tbody><tr><td>Protocol Identifier</td><td>2</td><td>协议ID，STP中值总为0</td></tr><tr><td>Protocol Version Identifier</td><td>1</td><td>协议版本ID，STP中值总为0</td></tr><tr><td>BPDU Type</td><td>1</td><td>BPDU类型，值为0x00就是配置BPDU；值为0x80就是TCN BPDU</td></tr><tr><td>Flags</td><td>1</td><td>标志位，最低位是TC标志，标识拓扑发生变化；<br>最高位是TCA标志，表示确认拓扑发生变化</td></tr><tr><td>Root Identifier</td><td>8</td><td>根桥ID，根桥的桥ID</td></tr><tr><td>Root Path Cost</td><td>4</td><td>根路径开销，到达根桥的路径开销</td></tr><tr><td>Bridge Identifier</td><td>8</td><td>桥ID，发送BPDU的交换机的桥ID</td></tr><tr><td>Port Identifier</td><td>2</td><td>接口ID，发送BPDU的端口ID</td></tr><tr><td>Message Age</td><td>2</td><td>消息有效期，实际是指BPDU经过的交换机的个数</td></tr><tr><td>Max Age</td><td>2</td><td>最大有效期，BPDU的最大存活时间，也叫老化时间，默认值是20s</td></tr><tr><td>Hello Time</td><td>2</td><td>BPDU的发送时间间隔，默认值是2s</td></tr><tr><td>Forward Delay</td><td>2</td><td>转发延迟，接口在侦听和学习状态所停留的时间，默认值是15s</td></tr></tbody></table><ol start="2"><li>拓扑变化通知 BPDU（<code>Topology Change Notification BPDU</code>）：简称 TCN BPDU，是非根桥通过根端口向根桥发送的。当非根桥检测到拓扑变化后，就会生成一个描述拓扑变化的 TCN BPDU，并从自己的根端口发送出去。</li></ol><figure><img src="'+b+'" alt="TCN BPDU 格式" tabindex="0" loading="lazy"><figcaption>TCN BPDU 格式</figcaption></figure><h2 id="stp-树的生成" tabindex="-1"><a class="header-anchor" href="#stp-树的生成"><span>STP 树的生成</span></a></h2><p>STP 的基本原理是在一个有二层环路的网络中，交换机通过运行 STP，自动生成一个没有环路的网络拓扑。这个无环网络拓扑也叫做 STP 树（STP Tree），树节点为某些交换机，树枝为某些链路。当网络拓扑发生变化时，STP 树也会自动地发生相应的改变。</p><figure><img src="'+u+'" alt="选举范围示意图" tabindex="0" loading="lazy"><figcaption>选举范围示意图</figcaption></figure><p>STP 树的生成过程是：<strong>首先选举根桥，然后确定根端口和指定端口，最后阻塞备用端口</strong>。既然是选举，我们就看下参选者和选举范围。</p><table><thead><tr><th>选举角色</th><th>参选者</th><th>选举范围</th></tr></thead><tbody><tr><td>根桥</td><td>交换机</td><td>整个二层网络</td></tr><tr><td>根端口</td><td>端口</td><td>每台交换机</td></tr><tr><td>指定端口</td><td>端口</td><td>每条链路</td></tr></tbody></table><p>STP 是通过比较 BPDU 中的信息进行选举的，最终的结果是：在整个 STP 网络中，唯一的一个根桥被选举出来；对于所有的非根桥，选举出根端口和指定端口，负责转发数据；落选的端口就是备用端口，处于阻塞状态，不能转发数据。</p><figure><img src="'+m+'" alt="交互BPDU" tabindex="0" loading="lazy"><figcaption>交互BPDU</figcaption></figure><h3 id="选举根桥" tabindex="-1"><a class="header-anchor" href="#选举根桥"><span>选举根桥</span></a></h3><p>根桥是 STP 树的根节点。要生成一棵 STP 树，首先要确定一个根桥。根桥是整个二层网络的逻辑中心，但不一定是物理中心。在 STP 交换机刚连接到网络时，每台交换机都以自己为根桥，BPDU 中的根桥 ID字段为自己的 BID，从所有启动的端口发送 BPDU，宣告自己是根桥。</p><p>收到 BPDU 的交换机会比较 BPDU 中的根桥 ID 与自己的 BID，选择 <strong>BID 值小</strong>的配置成自己 BPDU 中的根桥 ID。交换机不停地交互 BPDU，同时对根桥 ID 进行比较，直至选出一台根桥 ID 最小的交换机作为根桥。根桥会在固定的时间间隔发送 BPDU，其它设备对 BPDU 进行转发，从而保证网络拓扑的稳定。</p><figure><img src="'+v+'" alt="选举根桥" tabindex="0" loading="lazy"><figcaption>选举根桥</figcaption></figure><p>根桥交换机往往会承担这个网络中最大流量的转发工作，我们希望性能最高的交换机当选根桥交换机。但是 STP 在选举时，并不会把交换机的性能列入考量。为了让网络流量更合理的转发，可以通过配置桥优先级的值来影响根桥的选举。</p><figure><img src="'+R+'" alt="根桥的选举结果" tabindex="0" loading="lazy"><figcaption>根桥的选举结果</figcaption></figure><p>同时，根桥是可以抢占的，在 STP 完成网络收敛后，如果网络中接入一台新的交换机，且新增交换机的优先级比根桥交换机更优，那么新增交换机会成为网络中新的根桥。同时，STP 将会重新收敛、重新计算网络拓扑，这个过程会引发网络震荡，对流量的正常转发造成影响。</p><h3 id="选举根端口-root-port-rp" tabindex="-1"><a class="header-anchor" href="#选举根端口-root-port-rp"><span>选举根端口（Root Port，RP）</span></a></h3><p>根桥选举出来后，其它没有成为根桥的交换机称为非根桥。STP 会为每个非根桥选举一个根接口，也就是在交换机的所有端口中，选择距离根桥最近的一个端口，这就是根端口。</p><p>在 STP 树形成后的稳定期，根桥依然会周期性的向网络中发送 BPDU，而非根桥的根端口会收到 BPDU，并向指定端口发送出去。</p><p>那是如何选择根端口的呢？根桥周期性的发送 BPDU，非根桥的所有端口都能收到 BPDU，对比端口收到的 BPDU 中的参数值。</p><figure><img src="'+I+'" alt="选举根端口的流程" tabindex="0" loading="lazy"><figcaption>选举根端口的流程</figcaption></figure><p>选择根路径开销（RPC）最小的端口；</p><figure><img src="'+x+'" alt="选举根端口第一步" tabindex="0" loading="lazy"><figcaption>选举根端口第一步</figcaption></figure><p>如果 RPC 相同，那就选对端桥 ID（BID）最小的端口；</p><figure><img src="'+U+'" alt="选举根端口第二步" tabindex="0" loading="lazy"><figcaption>选举根端口第二步</figcaption></figure><p>如果对端桥 ID 相同，那就选对端端口 ID（ PID ）最小的端口。</p><figure><img src="'+M+'" alt="选举根端口第三步" tabindex="0" loading="lazy"><figcaption>选举根端口第三步</figcaption></figure><p>准确的说，选举根端口的目的是选举出 STP 网络中每台交换机上与根交换机通信效率最高的端口。</p><h3 id="选举指定端口-designated-port-dp" tabindex="-1"><a class="header-anchor" href="#选举指定端口-designated-port-dp"><span>选举指定端口（Designated Port ，DP）</span></a></h3><p>根端口确保了交换机到根桥的路径是唯一的，也是最优的。网络中的每条链路与根桥之间的路径也要是唯一且最优的。当一条链路中有两条或两条以上的路径到达根桥，就必须确定出一个唯一的指定端口，防止出现二层环路。指定端口不但是这条链路内所有端口中到达根桥的最优接口，还会向链路内发送 BPDU。虽然选举指定端口的范围和根端口不同，但是选举的原则是一致的。指定端口的选举同样会按照以下过程进行：</p><figure><img src="'+N+'" alt="选举指定端口的流程" tabindex="0" loading="lazy"><figcaption>选举指定端口的流程</figcaption></figure><ul><li>选择根路径开销（RPC）最小的端口；</li><li>如果 RPC 相同，那就选对端桥 ID 最小的端口；</li><li>如果对端桥 ID 相同，那就选对端端口 ID 最小的端口。</li></ul><figure><img src="'+k+'" alt="选举指定端口" tabindex="0" loading="lazy"><figcaption>选举指定端口</figcaption></figure><p>如果有人不小心将同一台交换机上的两个端口用网线连接起来，网络中就会产生环路。选举指定端口就是为了预防这种错误连接导致环路的情况。当出现这种连接时，STP 会以端口 ID 较小的端口作为指定端口，从而打破环路。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>为什么根桥交换机的所有端口都是指定端口呢？</p><p>因为根桥交换机端口的根路径开销都是 0，根据选择选举原则，成为这条链路的指定端口。</p></div><h3 id="阻塞备用端口-alternate-port-ap" tabindex="-1"><a class="header-anchor" href="#阻塞备用端口-alternate-port-ap"><span>阻塞备用端口（Alternate Port ，AP）</span></a></h3><p>在确定了根端口和指定端口后，交换机上剩下的非根端口和非指定端口都叫做备用端口。备用端口是打破环路的关键，STP 会对这些备用端口进行逻辑阻塞。逻辑阻塞，是指端口不会接收或发送任何数据，但是会监听 BPDU。当网络的一些端口出现故障时，STP 会让备用端口开始转发数据，用来恢复网络的正常通信。</p><figure><img src="'+E+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>三种端口的异同如下：</p><table><thead><tr><th>端口名称</th><th style="text-align:center;">发送BPDU</th><th style="text-align:center;">接收BPDU</th><th style="text-align:center;">发送数据</th><th style="text-align:center;">接收数据</th></tr></thead><tbody><tr><td>根端口</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td></tr><tr><td>指定端口</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td><td style="text-align:center;">是</td></tr><tr><td>备用端口</td><td style="text-align:center;">否</td><td style="text-align:center;">是</td><td style="text-align:center;">否</td><td style="text-align:center;">否</td></tr></tbody></table><p>一旦备用端口被逻辑阻塞后，STP 树的生成过程就完成了。</p><h2 id="stp-端口状态机" tabindex="-1"><a class="header-anchor" href="#stp-端口状态机"><span>STP 端口状态机</span></a></h2><p>STP 不但定义了 3 种端口角色：根端口、指定端口、备用端口，还定义了 5 种端口状态：禁用状态、阻塞状态、侦听状态、学习状态、转发状态。</p><table><thead><tr><th>状态名称</th><th>状态描述</th></tr></thead><tbody><tr><td>禁用（Disable）</td><td>端口还未启用，不能收发BPDU，也不能转发数据帧</td></tr><tr><td>阻塞（Blocking）</td><td>这是一种稳定状态，被STP阻塞。端口只能接收并处理BPDU，不能发送BPDU，不能转发数据帧，不会学习MAC地址</td></tr><tr><td>侦听（Listening）</td><td>过渡状态，端口处于STP计算过程中，可能是根接口，也可能是指定接口。可以收发并处理BPDU，不能转发数据帧，不会学习MAC地址</td></tr><tr><td>学习（Learning）</td><td>过渡状态，端口可以收发并处理BPDU，接收数据帧并学习MAC地址，但还不能转发数据帧</td></tr><tr><td>转发（Forwarding）</td><td>稳定状态，也是根端口和指定端口的最终状态。端口可以正常收发数据帧，学习MAC地址，也会进行BPDU处理</td></tr></tbody></table><p>STP 交换机的端口启动时，首先会从禁用状态自动进入到阻塞状态。在阻塞状态，端口只能接收和分析 BPDU，不能发送 BPDU。如果端口选为根端口或指定端口，则会进入侦听状态，这时端口可以接收并发送 BPDU，这种状态会持续一个<code>Forward Delay</code>的时间，默认是 15 秒。15 秒后端口会进入到学习状态，并持续一个<code>Forward Delay</code>的时间。学习状态的端口可以接收和发送 BPDU，同时开始进行 MAC 地址学习，为数据转发做好准备。最后，端口由学习状态进入到转发状态，就开始进行数据转发。在整个状态的迁移过程中，端口一旦关闭或发生链路故障，就会进入到禁用状态；如果端口不再是根端口或指定端口，那么端口状态会立刻退回到阻塞状态。</p><figure><img src="'+G+'" alt="STP端口状态机" tabindex="0" loading="lazy"><figcaption>STP端口状态机</figcaption></figure><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>在 STP 的生成过程中，为什么要有两个 Forward Delay 时间？</p><p>在侦听状态有一个<code>Forward Delay</code>的时间，是因为 BPDU 泛洪到全网需要一定的时间，STP 完成全网拓扑的计算同样需要时间，所以停留 15 秒让 STP 有充分的时间计算全网拓扑，避免网络中出现临时的环路。在学习状态又有一个<code>Forward Delay</code>的时间，是由于交换机的接口上未学习到任何 MAC 地址，需要时间学习 MAC 地址，避免网络中出现不必要的数据帧泛洪现象。停留 15 秒，为进入转发状态做好准备。</p></div><h3 id="stp-时间参数" tabindex="-1"><a class="header-anchor" href="#stp-时间参数"><span>STP 时间参数</span></a></h3><p>STP 定义了 3 个重要的时间参数。</p><ul><li><code>Hello Time</code>（<code>Hello</code>时间）：STP 交换机发送配置 BPDU 的时间间隔，默认是 2 秒。如果要修改时间参数，那么必须在根桥上修改才有效。</li><li><code>Forward Delay</code>（转发延迟）：接口从侦听状态进入学习状态，或从学习状态进入转发状态的延迟时间，默认值是 15 秒。避免在 STP 树的生成过程中可能出现的临时环路，或短暂的数据帧泛洪现象，分别在侦听和学习的端口状态各停留一个转发延迟时间。对于 STP 而言，一个阻塞端口选举为根接口或指定接口后，进入转发状态至少需要经历 30 秒的时间。</li><li><code>Max Age</code>（最大生存时间）：BPDU 的最大生存时间，也称为 BPDU 的老化时间，<code>Max Age</code>的值由根桥指定，默认值是 20 秒。如果端口在 20 秒内收到 BPDU，最大生存时间会重新计时；如果端口一直没收到 BPDU，那么 BPDU 将会老化，设备会重新在端口上选择最优 BPDU，也就是重新进行根接口的选举。</li></ul><p>由于时间参数的设计，一个 STP 接口从阻塞状态进入到转发状态，可能需要 30~50 秒的时间，这段时间内，网络无法正常使用。</p><h3 id="举例说明" tabindex="-1"><a class="header-anchor" href="#举例说明"><span>举例说明</span></a></h3><figure><img src="'+w+'" alt="端口状态迁移示意图" tabindex="0" loading="lazy"><figcaption>端口状态迁移示意图</figcaption></figure><p>交换机 A、B、C 一起启动，各交换机的每个互联端口立即从禁用状态进入到阻塞状态。在阻塞状态的端口只能接收而不能发送 BPDU，所以任何端口都收不到 BPDU。在等待<code>Max Age</code>后，每台交换机都会认为自己是根桥，所有端口的角色都成为指定端口，并且端口的状态迁移为侦听状态。</p><p>交换机的端口进入到侦听状态后，开始发送自己产生的配置 BPDU，同时也收到其它交换机发送的配置 BPDU。</p><p>因为各个交换机发送 BPDU 的时间有一定的随机性，所以有可能交换机 B 和交换机 C 先选举根桥为交换机 B，再收到交换机 A 的配置 BPDU，最后选举出根桥为交换机 A。因此，无论交换机开始的状态如何，也不管中间过程有多大差异，最终的结果总是确定且唯一的：桥 ID 最小的交换机会成为根桥。</p><p>端口在侦听状态持续<code>Forward Delay</code>的时间后，开始进入学习状态。由于交换机 C 的<code>G0/2</code>端口已经成为备用端口，所以状态也会变成阻塞状态。</p><p>各个端口（交换机 C 的<code>G0/2</code>端口除外）陆续进入学习状态后，会持续<code>Forward Delay</code>的时间。在这段时间里，交换机开始学习 MAC 地址和端口的映射关系，同时希望 STP 树在这个时间内能够完全收敛。</p><p>之后各个端口（交换机 C 的<code>G0/2</code>端口除外）相继进入转发状态，开始进行数据帧的转发。</p><h2 id="实战" tabindex="-1"><a class="header-anchor" href="#实战"><span>实战</span></a></h2><h3 id="stp-基础配置" tabindex="-1"><a class="header-anchor" href="#stp-基础配置"><span>STP 基础配置</span></a></h3><p>我们用 3 台交换机搭建一个网络环境，而且网络中存在二层环路。为了对网络进行破环，将在交换机上部署 STP。</p><h4 id="网络拓扑" tabindex="-1"><a class="header-anchor" href="#网络拓扑"><span>网络拓扑</span></a></h4><figure><img src="'+W+`" alt="实验拓扑图" tabindex="0" loading="lazy"><figcaption>实验拓扑图</figcaption></figure><h4 id="实验要求" tabindex="-1"><a class="header-anchor" href="#实验要求"><span>实验要求</span></a></h4><p>三台交换机（ SW ）配置 STP 功能，使用命令指定根桥交换机，使用命令改变端口状态。</p><h4 id="操作步骤" tabindex="-1"><a class="header-anchor" href="#操作步骤"><span>操作步骤</span></a></h4><ol><li>三台 SW 按照网络拓扑图，对相应的端口进行连接。SW 默认的生成树工作模式是 MSTP，并且自动协商出了根桥、根端口和指定端口。交换机的桥优先级默认是 32768，MAC 地址最小的交换机成为网络中的根桥。通过命令查看，发现 SWC 选举为根桥。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;"># SWA</span></span>
<span class="line"><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;">Huawei</span><span style="color:#FF9492;">&gt;</span><span style="color:#F0F3F6;">system-view </span></span>
<span class="line"><span style="color:#F0F3F6;">[Huawei]sysname SWA</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWA]display stp</span></span>
<span class="line"><span style="color:#FFB757;">-------[CIST</span><span style="color:#ADDCFF;"> Global</span><span style="color:#ADDCFF;"> Info][Mode</span><span style="color:#ADDCFF;"> MSTP]-------</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Bridge</span><span style="color:#ADDCFF;">         :32768.4c1f-cc4c-6f4e</span></span>
<span class="line"><span style="color:#FFB757;">Config</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">Active</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Root/ERPC</span><span style="color:#ADDCFF;">      :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 20000</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RegRoot/IRPC</span><span style="color:#ADDCFF;">   :32768.4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RootPortId</span><span style="color:#ADDCFF;">     :128.2</span></span>
<span class="line"><span style="color:#FFB757;">BPDU-Protection</span><span style="color:#ADDCFF;">     :Disabled</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :2</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> count</span><span style="color:#ADDCFF;"> per</span><span style="color:#ADDCFF;"> hello</span><span style="color:#ADDCFF;">  :0</span></span>
<span class="line"><span style="color:#FFB757;">STP</span><span style="color:#ADDCFF;"> Converge</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">   :Normal</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;">Time</span><span style="color:#ADDCFF;"> since</span><span style="color:#ADDCFF;"> last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">  :0</span><span style="color:#ADDCFF;"> days</span><span style="color:#ADDCFF;"> 0h:2m:34s</span></span>
<span class="line"><span style="color:#FFB757;">Number</span><span style="color:#ADDCFF;"> of</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">        :3</span></span>
<span class="line"><span style="color:#FFB757;">Last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;"> occurred</span><span style="color:#ADDCFF;">    :GigabitEthernet0/0/1</span></span>
<span class="line"><span style="color:#FFB757;">----[Port1(GigabitEthernet0/0/1</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Designated</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.1</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :2</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :75</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 75</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 2</span></span>
<span class="line"><span style="color:#FFB757;">----[Port2(GigabitEthernet0/0/2</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Root</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.1</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :1</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 2</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :110</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 110</span></span>
<span class="line"><span style="color:#BDC4CC;">#省略输出</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;"># SWB</span></span>
<span class="line"><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;">Huawei</span><span style="color:#FF9492;">&gt;</span><span style="color:#F0F3F6;">system-view</span></span>
<span class="line"><span style="color:#F0F3F6;">[Huawei]sysname SWB</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWB]display stp</span></span>
<span class="line"><span style="color:#FFB757;">-------[CIST</span><span style="color:#ADDCFF;"> Global</span><span style="color:#ADDCFF;"> Info][Mode</span><span style="color:#ADDCFF;"> MSTP]-------</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Bridge</span><span style="color:#ADDCFF;">         :32768.4c1f-cc79-56e9</span></span>
<span class="line"><span style="color:#FFB757;">Config</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">Active</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Root/ERPC</span><span style="color:#ADDCFF;">      :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 20000</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RegRoot/IRPC</span><span style="color:#ADDCFF;">   :32768.4c1f-cc79-56e9</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RootPortId</span><span style="color:#ADDCFF;">     :128.2</span></span>
<span class="line"><span style="color:#FFB757;">BPDU-Protection</span><span style="color:#ADDCFF;">     :Disabled</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :4</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> count</span><span style="color:#ADDCFF;"> per</span><span style="color:#ADDCFF;"> hello</span><span style="color:#ADDCFF;">  :0</span></span>
<span class="line"><span style="color:#FFB757;">STP</span><span style="color:#ADDCFF;"> Converge</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">   :Normal</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;">Time</span><span style="color:#ADDCFF;"> since</span><span style="color:#ADDCFF;"> last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">  :0</span><span style="color:#ADDCFF;"> days</span><span style="color:#ADDCFF;"> 0h:3m:19s</span></span>
<span class="line"><span style="color:#FFB757;">Number</span><span style="color:#ADDCFF;"> of</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">        :3</span></span>
<span class="line"><span style="color:#FFB757;">Last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;"> occurred</span><span style="color:#ADDCFF;">    :GigabitEthernet0/0/2</span></span>
<span class="line"><span style="color:#FFB757;">----[Port1(GigabitEthernet0/0/1</span><span style="color:#F0F3F6;">)][DISCARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Alternate</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.1</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :1</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :2</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 2</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :95</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 95</span></span>
<span class="line"><span style="color:#FFB757;">----[Port2(GigabitEthernet0/0/2</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Root</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.2</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :1</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :2</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :3</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 3</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :102</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 102</span></span>
<span class="line"><span style="color:#BDC4CC;">#省略输出</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">#SWC</span></span>
<span class="line"><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;">Huawei</span><span style="color:#FF9492;">&gt;</span><span style="color:#F0F3F6;">system-view</span></span>
<span class="line"><span style="color:#F0F3F6;">[Huawei]sysname SWC</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWC]display stp </span></span>
<span class="line"><span style="color:#FFB757;">-------[CIST</span><span style="color:#ADDCFF;"> Global</span><span style="color:#ADDCFF;"> Info][Mode</span><span style="color:#ADDCFF;"> MSTP]-------</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Bridge</span><span style="color:#ADDCFF;">         :32768.4c1f-cc32-2e45</span></span>
<span class="line"><span style="color:#FFB757;">Config</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">Active</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Root/ERPC</span><span style="color:#ADDCFF;">      :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RegRoot/IRPC</span><span style="color:#ADDCFF;">   :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RootPortId</span><span style="color:#ADDCFF;">     :0.0</span></span>
<span class="line"><span style="color:#FFB757;">BPDU-Protection</span><span style="color:#ADDCFF;">     :Disabled</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :2</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> count</span><span style="color:#ADDCFF;"> per</span><span style="color:#ADDCFF;"> hello</span><span style="color:#ADDCFF;">  :0</span></span>
<span class="line"><span style="color:#FFB757;">STP</span><span style="color:#ADDCFF;"> Converge</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">   :Normal</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;">Time</span><span style="color:#ADDCFF;"> since</span><span style="color:#ADDCFF;"> last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">  :0</span><span style="color:#ADDCFF;"> days</span><span style="color:#ADDCFF;"> 0h:5m:57s</span></span>
<span class="line"><span style="color:#FFB757;">Number</span><span style="color:#ADDCFF;"> of</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">        :2</span></span>
<span class="line"><span style="color:#FFB757;">Last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;"> occurred</span><span style="color:#ADDCFF;">    :GigabitEthernet0/0/2</span></span>
<span class="line"><span style="color:#FFB757;">----[Port1(GigabitEthernet0/0/1</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Designated</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.1</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :1</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :164</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 164</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 2</span></span>
<span class="line"><span style="color:#FFB757;">----[Port2(GigabitEthernet0/0/2</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Designated</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :32768.4c1f-cc32-2e45</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.2</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :MSTP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :2</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :166</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 166</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :3</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 3</span></span></code></pre></div><ol start="2"><li>在三台交换机上分别配置工作模式从默认的 MSTP 改成 STP，并且启动 STP 功能。<code>stp mode</code>命令用来修改交换机的工作模式。<code>stp enable</code>命令用在设备上激活生成树功能，默认处于激活状态，所以这条命令为可选。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWA]stp </span><span style="color:#FF9492;">?</span></span>
<span class="line"><span style="color:#FFB757;">  bpdu-filter</span><span style="color:#ADDCFF;">           STP</span><span style="color:#ADDCFF;"> BPDU</span><span style="color:#ADDCFF;"> filter</span></span>
<span class="line"><span style="color:#FFB757;">  bpdu-protection</span><span style="color:#ADDCFF;">       Specify</span><span style="color:#ADDCFF;"> BPDU</span><span style="color:#ADDCFF;"> protection</span><span style="color:#ADDCFF;"> function</span></span>
<span class="line"><span style="color:#FFB757;">  bridge-diameter</span><span style="color:#ADDCFF;">       Specify</span><span style="color:#ADDCFF;"> bridge</span><span style="color:#ADDCFF;"> diameter</span></span>
<span class="line"><span style="color:#FFB757;">  converge</span><span style="color:#ADDCFF;">              Specify</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> converge</span><span style="color:#ADDCFF;"> mode</span></span>
<span class="line"><span style="color:#FFB757;">  disable</span><span style="color:#ADDCFF;">               Disable</span><span style="color:#ADDCFF;"> Spanning</span><span style="color:#ADDCFF;"> Tree</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#F0F3F6;"> (STP)</span></span>
<span class="line"><span style="color:#FFB757;">  edged-port</span><span style="color:#ADDCFF;">            Specify</span><span style="color:#ADDCFF;"> edge</span><span style="color:#ADDCFF;"> port</span></span>
<span class="line"><span style="color:#FFB757;">  enable</span><span style="color:#ADDCFF;">                Enable</span><span style="color:#ADDCFF;"> Spanning</span><span style="color:#ADDCFF;"> Tree</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#F0F3F6;"> (STP)</span></span>
<span class="line"><span style="color:#FFB757;">  instance</span><span style="color:#ADDCFF;">              Spanning</span><span style="color:#ADDCFF;"> tree</span><span style="color:#ADDCFF;"> instance</span></span>
<span class="line"><span style="color:#FFB757;">  max-hops</span><span style="color:#ADDCFF;">              Specify</span><span style="color:#ADDCFF;"> max</span><span style="color:#ADDCFF;"> hops</span></span>
<span class="line"><span style="color:#FFB757;">  mcheck</span><span style="color:#ADDCFF;">                Specify</span><span style="color:#ADDCFF;"> mcheck</span></span>
<span class="line"><span style="color:#FFB757;">  mode</span><span style="color:#ADDCFF;">                  Specify</span><span style="color:#ADDCFF;"> state</span><span style="color:#ADDCFF;"> machine</span><span style="color:#ADDCFF;"> mode</span></span>
<span class="line"><span style="color:#FFB757;">  pathcost-standard</span><span style="color:#ADDCFF;">     Specify</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> port</span><span style="color:#ADDCFF;"> path</span><span style="color:#ADDCFF;"> cost</span><span style="color:#ADDCFF;"> standard</span></span>
<span class="line"><span style="color:#FFB757;">  priority</span><span style="color:#ADDCFF;">              Specify</span><span style="color:#ADDCFF;"> bridge</span><span style="color:#ADDCFF;"> priority</span></span>
<span class="line"><span style="color:#FFB757;">  process</span><span style="color:#ADDCFF;">               The</span><span style="color:#ADDCFF;"> MSTP</span><span style="color:#ADDCFF;"> process</span></span>
<span class="line"><span style="color:#FFB757;">  region-configuration</span><span style="color:#ADDCFF;">  Enter</span><span style="color:#ADDCFF;"> MSTP</span><span style="color:#ADDCFF;"> region</span><span style="color:#ADDCFF;"> view</span></span>
<span class="line"><span style="color:#FFB757;">  root</span><span style="color:#ADDCFF;">                  Specify</span><span style="color:#ADDCFF;"> root</span><span style="color:#ADDCFF;"> switch</span></span>
<span class="line"><span style="color:#FFB757;">  snooping</span><span style="color:#ADDCFF;">              STP</span><span style="color:#ADDCFF;"> snooping</span></span>
<span class="line"><span style="color:#FFB757;">  tc-protection</span><span style="color:#ADDCFF;">         Enable</span><span style="color:#ADDCFF;"> the</span><span style="color:#ADDCFF;"> TC-BPDU</span><span style="color:#ADDCFF;"> Protection</span><span style="color:#ADDCFF;"> function</span></span>
<span class="line"><span style="color:#FFB757;">  timer</span><span style="color:#ADDCFF;">                 Specify</span><span style="color:#ADDCFF;"> timer</span><span style="color:#ADDCFF;"> configuration</span></span>
<span class="line"><span style="color:#FFB757;">  timer-factor</span><span style="color:#ADDCFF;">          Specify</span><span style="color:#ADDCFF;"> aged</span><span style="color:#ADDCFF;"> out</span><span style="color:#ADDCFF;"> time</span><span style="color:#ADDCFF;"> factor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">[SWA]stp mode </span><span style="color:#FF9492;">?</span></span>
<span class="line"><span style="color:#FFB757;">  mstp</span><span style="color:#ADDCFF;">  Multiple</span><span style="color:#ADDCFF;"> Spanning</span><span style="color:#ADDCFF;"> Tree</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#F0F3F6;"> (MSTP) mode</span></span>
<span class="line"><span style="color:#FFB757;">  rstp</span><span style="color:#ADDCFF;">  Rapid</span><span style="color:#ADDCFF;"> Spanning</span><span style="color:#ADDCFF;"> Tree</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#F0F3F6;"> (RSTP) mode</span></span>
<span class="line"><span style="color:#FFB757;">  stp</span><span style="color:#ADDCFF;">   Spanning</span><span style="color:#ADDCFF;"> Tree</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#F0F3F6;"> (STP) mode</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">[SWA]stp mode stp</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWA]stp enable</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">#SWB</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWB]stp mode stp</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWB]stp enable</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">#SWC</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWC]stp mode stp</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWC]stp enable</span></span></code></pre></div><ol start="3"><li>在实际的网络部署中，我们通常会修改某台设备的优先级，确保它成为这个网络的根桥，从而保证 STP 的稳定性。假设 SWA 是高性能的核心交换机，SWB 和 SWC 是普通性能的接入交换机。可以将 SWA 设置成根桥。在 SWA 配置<code>stp root primary</code>命令让它成为网络中的根桥，实际上这条命令是把交换机的优先级设置成最小值 0，而且这个优先级不能修改。因此在 SWA 使用替代命令<code>stp priority 0</code>也能实现相同效果。<code>stp priority</code>命令可以修改设备的 STP 优先级，取值范围是 0~61440，而且要是 4096 的倍数，例如 0、4096、8192 等。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWA]stp root primary</span></span>
<span class="line"><span style="color:#BDC4CC;"># 等价于</span></span>
<span class="line"><span style="color:#BDC4CC;">#[SWA]stp priority 0</span></span></code></pre></div><ol start="4"><li>在 SWA 上使用<code>display stp</code>命令查看 STP 状态。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWA]display stp</span></span>
<span class="line"><span style="color:#FFB757;">-------[CIST</span><span style="color:#ADDCFF;"> Global</span><span style="color:#ADDCFF;"> Info][Mode</span><span style="color:#ADDCFF;"> STP]-------</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Bridge</span><span style="color:#ADDCFF;">         :0</span><span style="color:#ADDCFF;">    .4c1f-cc4c-6f4e</span></span>
<span class="line"><span style="color:#FFB757;">Config</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">Active</span><span style="color:#ADDCFF;"> Times</span><span style="color:#ADDCFF;">        :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> MaxHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Root/ERPC</span><span style="color:#ADDCFF;">      :0</span><span style="color:#ADDCFF;">    .4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RegRoot/IRPC</span><span style="color:#ADDCFF;">   :0</span><span style="color:#ADDCFF;">    .4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> RootPortId</span><span style="color:#ADDCFF;">     :0.0</span></span>
<span class="line"><span style="color:#FFB757;">BPDU-Protection</span><span style="color:#ADDCFF;">     :Disabled</span></span>
<span class="line"><span style="color:#FFB757;">CIST</span><span style="color:#ADDCFF;"> Root</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">      :Primary</span><span style="color:#ADDCFF;"> root</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :5</span></span>
<span class="line"><span style="color:#FFB757;">TC</span><span style="color:#ADDCFF;"> count</span><span style="color:#ADDCFF;"> per</span><span style="color:#ADDCFF;"> hello</span><span style="color:#ADDCFF;">  :0</span></span>
<span class="line"><span style="color:#FFB757;">STP</span><span style="color:#ADDCFF;"> Converge</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">   :Normal</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;">Time</span><span style="color:#ADDCFF;"> since</span><span style="color:#ADDCFF;"> last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">  :0</span><span style="color:#ADDCFF;"> days</span><span style="color:#ADDCFF;"> 0h:0m:1s</span></span>
<span class="line"><span style="color:#FFB757;">Number</span><span style="color:#ADDCFF;"> of</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;">        :6</span></span>
<span class="line"><span style="color:#FFB757;">Last</span><span style="color:#ADDCFF;"> TC</span><span style="color:#ADDCFF;"> occurred</span><span style="color:#ADDCFF;">    :GigabitEthernet0/0/2</span></span>
<span class="line"><span style="color:#FFB757;">----[Port1(GigabitEthernet0/0/1</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Designated</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :0.4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.1</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :STP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :2</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :19</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 19,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 1,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 1,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;">----[Port2(GigabitEthernet0/0/2</span><span style="color:#F0F3F6;">)][FORWARDING]----</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;">       :Enabled</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Role</span><span style="color:#ADDCFF;">           :Designated</span><span style="color:#ADDCFF;"> Port</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Priority</span><span style="color:#ADDCFF;">       :128</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Cost</span><span style="color:#F0F3F6;">(</span><span style="color:#FFB757;">Dot1T</span><span style="color:#F0F3F6;"> )   </span><span style="color:#ADDCFF;">:Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">20000</span></span>
<span class="line"><span style="color:#FFB757;"> Designated</span><span style="color:#ADDCFF;"> Bridge/Port</span><span style="color:#ADDCFF;">   :0.4c1f-cc4c-6f4e</span><span style="color:#ADDCFF;"> /</span><span style="color:#91CBFF;"> 128.2</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Edged</span><span style="color:#ADDCFF;">          :Config=default</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=disabled</span></span>
<span class="line"><span style="color:#FFB757;"> Point-to-point</span><span style="color:#ADDCFF;">      :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=</span><span style="color:#91CBFF;">true</span></span>
<span class="line"><span style="color:#FFB757;"> Transit</span><span style="color:#ADDCFF;"> Limit</span><span style="color:#ADDCFF;">       :147</span><span style="color:#ADDCFF;"> packets/hello-time</span></span>
<span class="line"><span style="color:#FFB757;"> Protection</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">     :None</span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> STP</span><span style="color:#ADDCFF;"> Mode</span><span style="color:#ADDCFF;">       :STP</span><span style="color:#F0F3F6;"> </span></span>
<span class="line"><span style="color:#FFB757;"> Port</span><span style="color:#ADDCFF;"> Protocol</span><span style="color:#ADDCFF;"> Type</span><span style="color:#ADDCFF;">  :Config=auto</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=dot1s</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Encapsulation</span><span style="color:#ADDCFF;">  :Config=stp</span><span style="color:#ADDCFF;"> /</span><span style="color:#ADDCFF;"> Active=stp</span></span>
<span class="line"><span style="color:#FFB757;"> PortTimes</span><span style="color:#ADDCFF;">           :Hello</span><span style="color:#ADDCFF;"> 2s</span><span style="color:#ADDCFF;"> MaxAge</span><span style="color:#ADDCFF;"> 20s</span><span style="color:#ADDCFF;"> FwDly</span><span style="color:#ADDCFF;"> 15s</span><span style="color:#ADDCFF;"> RemHop</span><span style="color:#91CBFF;"> 20</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> send</span><span style="color:#ADDCFF;">      :4</span></span>
<span class="line"><span style="color:#FFB757;"> TC</span><span style="color:#ADDCFF;"> or</span><span style="color:#ADDCFF;"> TCN</span><span style="color:#ADDCFF;"> received</span><span style="color:#ADDCFF;">  :1</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Sent</span><span style="color:#ADDCFF;">           :21</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 21,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#FFB757;"> BPDU</span><span style="color:#ADDCFF;"> Received</span><span style="color:#ADDCFF;">       :2</span><span style="color:#F0F3F6;">             </span></span>
<span class="line"><span style="color:#FFB757;">          TCN:</span><span style="color:#ADDCFF;"> 1,</span><span style="color:#ADDCFF;"> Config:</span><span style="color:#ADDCFF;"> 1,</span><span style="color:#ADDCFF;"> RST:</span><span style="color:#ADDCFF;"> 0,</span><span style="color:#ADDCFF;"> MST:</span><span style="color:#91CBFF;"> 0</span></span>
<span class="line"><span style="color:#BDC4CC;"># 省略输出</span></span></code></pre></div><p>交换机的桥 ID 是<code>0 .4c1f-cc4c-6f4e</code>，其中 0 为交换机的优先级值，这就是命令<code>stp root primary</code>的作用。<code>4c1f-cc4c-6f4e</code>是交换机的 MAC 地址，且根桥的 MAC 地址也是 <code>4c1f-cc4c-6f4e</code>，说明这台交换机就是根桥。</p><ol start="5"><li>还可以使用<code>display stp brief</code>命令查看接口的 STP 状态。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWA]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        DESI</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        DESI</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><p>由于 SWA 是根桥，所有端口都是指定接口（<code>DESI</code>），都处于转发状态（<code>FORWARDING</code>）。</p><ol start="6"><li>SWB 的<code>G0/0/2</code>端口将会被阻塞，命令输出如下。为什么<code>G0/0/2</code>的端口状态是禁用，而不是阻塞。因为 STP 已经不再使用，交换机默认使用 MSTP，即使将生成树的模式修改为 STP，交换机的端口状态依然和 MSTP 保持一致。端口角色（<code>Role</code>）也是 MSTP 中的概念。</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWB]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        ROOT</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        ALTE</span><span style="color:#ADDCFF;">  DISCARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><ol start="7"><li>因为 SWB 的<code>G0/0/1</code>端口是根端口，收到的 BPDU 比<code>G0/0/2</code>收到的更优，所以端口被阻塞。如果我们希望阻塞的不是<code>G0/0/2</code>，而是<code>G0/0/1</code>端口，那就要让<code>G0/0/2</code>成为根端口，比如将<code>G0/0/1</code>端口的<code>Cost</code>值调大，让 SWB 的<code>G0/0/1</code>到达根桥的 RPC 比<code>G0/0/2</code>的更大。SWB 增加配置如下：</li></ol><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWB]interface GigabitEthernet 0/0/1</span></span>
<span class="line"><span style="color:#F0F3F6;">[SWB-GigabitEthernet0/0/1]stp cost 50000</span></span></code></pre></div><p>我们再观察下 SWB 的端口状态，<code>G0/0/2</code>端口成为根端口，<code>G0/0/1</code>端口被阻塞。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWB-GigabitEthernet0/0/1]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        ALTE</span><span style="color:#ADDCFF;">  DISCARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        ROOT</span><span style="color:#ADDCFF;">  DISCARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><h4 id="功能验证" tabindex="-1"><a class="header-anchor" href="#功能验证"><span>功能验证</span></a></h4><p>查看三台 STP 交换机的端口状态，是否符合预期结果。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWA]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        DESI</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        DESI</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWB]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        ALTE</span><span style="color:#ADDCFF;">  DISCARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        ROOT</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">[SWC]display stp brief </span></span>
<span class="line"><span style="color:#FFB757;"> MSTID</span><span style="color:#ADDCFF;">  Port</span><span style="color:#ADDCFF;">                        Role</span><span style="color:#ADDCFF;">  STP</span><span style="color:#ADDCFF;"> State</span><span style="color:#ADDCFF;">     Protection</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/1</span><span style="color:#ADDCFF;">        ROOT</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span>
<span class="line"><span style="color:#FFB757;">   0</span><span style="color:#ADDCFF;">    GigabitEthernet0/0/2</span><span style="color:#ADDCFF;">        DESI</span><span style="color:#ADDCFF;">  FORWARDING</span><span style="color:#ADDCFF;">      NONE</span></span></code></pre></div><p>还可以抓包验证 STP 交互的 BPDU 报文内容是否正常。</p><figure><img src="`+z+'" alt="查看三台交换机的端口状态" tabindex="0" loading="lazy"><figcaption>查看三台交换机的端口状态</figcaption></figure>',140)]))}const J=n(H,[["render",O],["__file","STP详解.html.vue"]]),_=JSON.parse('{"path":"/network/STP%E8%AF%A6%E8%A7%A3.html","title":"STP详解","lang":"zh-CN","frontmatter":{"title":"STP详解","date":"2025-01-20T00:00:00.000Z","tags":"network","categories":"计算机网络","order":5,"description":"网络环路 网络通信中，通常是以一条链路能够正常工作为前提，如果链路断开或节点故障，那么互联的设备就无法正常通信了，这类网络问题叫做单点故障。没有备份的链路或节点，出现故障会直接断网。 单点故障单点故障 如果要提供 24 小时不间断的服务，那就需要在网络中提前部署冗余。避免出现单点故障，合理的做法是在网络中的关键设备和关键链路添加冗余。在冗余的网络环境中...","head":[["meta",{"property":"og:url","content":"https://0oWSQo0.github.io/wsq-blog/network/STP%E8%AF%A6%E8%A7%A3.html"}],["meta",{"property":"og:title","content":"STP详解"}],["meta",{"property":"og:description","content":"网络环路 网络通信中，通常是以一条链路能够正常工作为前提，如果链路断开或节点故障，那么互联的设备就无法正常通信了，这类网络问题叫做单点故障。没有备份的链路或节点，出现故障会直接断网。 单点故障单点故障 如果要提供 24 小时不间断的服务，那就需要在网络中提前部署冗余。避免出现单点故障，合理的做法是在网络中的关键设备和关键链路添加冗余。在冗余的网络环境中..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-14T10:35:45.000Z"}],["meta",{"property":"article:published_time","content":"2025-01-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-05-14T10:35:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"STP详解\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-01-20T00:00:00.000Z\\",\\"dateModified\\":\\"2025-05-14T10:35:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"WSQ\\",\\"url\\":\\"https://0oWSQo0.github.com\\"}]}"]]},"headers":[{"level":2,"title":"网络环路","slug":"网络环路","link":"#网络环路","children":[]},{"level":2,"title":"STP 基本概念","slug":"stp-基本概念","link":"#stp-基本概念","children":[{"level":3,"title":"桥 ID（Bridge ID，BID）","slug":"桥-id-bridge-id-bid","link":"#桥-id-bridge-id-bid","children":[]},{"level":3,"title":"根桥（Root Bridge，RB）","slug":"根桥-root-bridge-rb","link":"#根桥-root-bridge-rb","children":[]},{"level":3,"title":"根路径开销（Root Path Cost，RPC）","slug":"根路径开销-root-path-cost-rpc","link":"#根路径开销-root-path-cost-rpc","children":[]},{"level":3,"title":"端口 ID（Port ID，PID）","slug":"端口-id-port-id-pid","link":"#端口-id-port-id-pid","children":[]},{"level":3,"title":"BPDU","slug":"bpdu","link":"#bpdu","children":[]}]},{"level":2,"title":"STP 树的生成","slug":"stp-树的生成","link":"#stp-树的生成","children":[{"level":3,"title":"选举根桥","slug":"选举根桥","link":"#选举根桥","children":[]},{"level":3,"title":"选举根端口（Root Port，RP）","slug":"选举根端口-root-port-rp","link":"#选举根端口-root-port-rp","children":[]},{"level":3,"title":"选举指定端口（Designated Port ，DP）","slug":"选举指定端口-designated-port-dp","link":"#选举指定端口-designated-port-dp","children":[]},{"level":3,"title":"阻塞备用端口（Alternate Port ，AP）","slug":"阻塞备用端口-alternate-port-ap","link":"#阻塞备用端口-alternate-port-ap","children":[]}]},{"level":2,"title":"STP 端口状态机","slug":"stp-端口状态机","link":"#stp-端口状态机","children":[{"level":3,"title":"STP 时间参数","slug":"stp-时间参数","link":"#stp-时间参数","children":[]},{"level":3,"title":"举例说明","slug":"举例说明","link":"#举例说明","children":[]}]},{"level":2,"title":"实战","slug":"实战","link":"#实战","children":[{"level":3,"title":"STP 基础配置","slug":"stp-基础配置","link":"#stp-基础配置","children":[]}]}],"git":{"createdTime":1730426129000,"updatedTime":1747218945000,"contributors":[{"name":"WSQ","email":"592786982@qq.com","commits":3},{"name":"WSQ-LK","email":"592786982@qq.com","commits":1}]},"readingTime":{"minutes":29.23,"words":8770},"filePathRelative":"network/STP详解.md","localizedDate":"2025年1月20日","autoDesc":true}');export{J as comp,_ as data};
