<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://0oWSQo0.github.io/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.html"><meta property="og:description" content="我们看下源码的实现：Spring 如何实现将资源配置（以xml配置为例）通过加载，解析，生成BeanDefination并注册到 IoC 容器中的（圈出来的部分）。 如何将Bean从XML配置中解析后放到IoC容器中的？ 初始化的入口 对于xml配置的 Spring 应用，在main()方法中实例化ClasspathXmlApplicationCont..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-11-01T01:55:29.000Z"><meta property="article:modified_time" content="2024-11-01T01:55:29.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2024-11-01T01:55:29.000Z","author":[{"@type":"Person","name":"WSQ","url":"https://0oWSQo0.github.com"}]}</script><title></title><meta name="description" content="我们看下源码的实现：Spring 如何实现将资源配置（以xml配置为例）通过加载，解析，生成BeanDefination并注册到 IoC 容器中的（圈出来的部分）。 如何将Bean从XML配置中解析后放到IoC容器中的？ 初始化的入口 对于xml配置的 Spring 应用，在main()方法中实例化ClasspathXmlApplicationCont...">
    <link rel="preload" href="/wsq-blog/assets/style-B8iyyxn3.css" as="style"><link rel="stylesheet" href="/wsq-blog/assets/style-B8iyyxn3.css">
    <link rel="modulepreload" href="/wsq-blog/assets/app-ByvFWdWZ.js"><link rel="modulepreload" href="/wsq-blog/assets/Spring详解—IOC实现原理之IOC初始化流程.html-evZn4OW2.js"><link rel="modulepreload" href="/wsq-blog/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/wsq-blog/assets/index.html-BSfQOsmx.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/portfolio.html-aHfkZTSn.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/进制.html-DHZgwlKB.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ACL详解.html-BG-9ozo-.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ARP详解.html-CoAu515q.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/BGP详解.html-B0vP4-86.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/DHCP详解.html-CJWr4evl.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/DNS详解.html-C3uLkQW1.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/HTTPS详解.html-PwKzMMU8.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ICMP详解.html-DMGU3oKV.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/IPv6详解.html-CGCSxNQ3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/IP详解.html-By96tj_6.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ISIS详解.html-QX-zOd5K.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/NAT详解.html-oKsWiWu7.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/OSPF-LSA.html-BcAeDk7b.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/OSPF实战.html-HEF_CxJl.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/OSPF特性.html-DqfIIFbt.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/OSPF详解.html-DBPjZX1F.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/RIP详解.html-Dp2werqk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/RSTP、MSTP详解.html-BkdsM3dk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/STP详解.html-CXykSBv0.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/TCP和UDP详解.html-DOjpuEes.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/VLAN详解.html-Cs5aTN0A.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/VPN详解.html-DIX5mqrQ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Wireshark使用教程.html-D2hm1f-q.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/三层交换机.html-CSnJfryn.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/华为命令.html-Xfb3vFgI.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/应用层协议详解.html-DF9V027c.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/数据链路层基础知识.html-RJ-3LMqY.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/无线网络详解.html-DAdsiXxr.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/校验码.html-AaGZ4PbG.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/网关冗余技术.html-Bo1MWUDW.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/网络基础知识.html-DKfZSiD6.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/路由协议详解.html-BhMnSkRC.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/路由器.html-CX8AbjPj.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/路由高级特性.html-C1KK18Nb.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/链路聚合技术.html-CPeE4qmK.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/防火墙.html-PXiYXuwb.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/网站收藏.html-DfPRdxuJ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python元组.html-pPDcDKpA.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python函数.html-BAyS2nq3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python列表.html-D0iUsYLh.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python变量.html-Dob3TVPT.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python基础.html-DlUfRVIf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python字典.html-p3EFtVd5.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python字符串常用方法.html-DwxuRDTL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python异常处理机制.html-1EJpIJP6.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python文件操作.html-BampCUzW.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python模块和包.html-DT94KGxu.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python流程控制.html-BQteD_Oc.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python爬虫.html-DCJ77gGX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python类和对象.html-BJWQ-n2N.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python类特殊成员.html-Bp9QlXU0.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python运算符.html-KnBNpqs3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/python集合.html-DxbldGD7.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-SKV1j3iL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/disable.html-CA0sRvUs.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/encrypt.html-DmVbgUGC.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/layout.html-TNoAkjd0.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/markdown.html-DMg2DnL4.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/page.html-B_GQWWBa.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/华为数通笔记.html-Bi3N2Pns.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/网络.html-BGAcJ14_.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringJdbcTemplate.html-DOL86e0C.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring事务.html-DLAfkzgs.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring的整体脉络.html-CClZmSak.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—IOC实现原理之Bean实例化.html-Dk2CwHZp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—IOC实现原理之IOC体系结构设计.html-UJrVth3p.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—Spring和Spring框架组成.html-CkuhG0Eh.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—控制反转IOC.html-C-Bc39vk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—简单例子引入Spring要点.html-B84hetmE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Spring详解—面向切面编程(AOP).html-BQgkoZqE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java 集合.html-0N_TzQnO.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java修饰符和关键字.html-BvJVQVsA.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java内置包装类.html-C-hepOv9.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java内部类.html-C4FdaWwD.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java反射机制.html-oeYtGez1.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java基础—SPI机制.html-4uzh2WVf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java基础—反射机制.html-D-MKugyK.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java基础—异常机制.html-DDNQwipA.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java基础—泛型机制.html-DP1S8174.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java基础—注解机制.html-CU-x5J0P.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java字符串处理.html-9GnXb1Rp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java序列化与反序列化.html-DnBMRZ9y.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java异常处理.html-Cp-IrG4Q.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java数字处理.html-BvXjAFNI.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java数组.html-BNEHH_1f.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java数组操作.html-BwfqtLvL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java时间日期的处理.html-CuaVPbFo.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java泛型和枚举.html-Bibi9yzw.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java类和对象.html-Bm5x8XBN.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Java输入输出流.html-OlFLa09Y.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/java继承封装和多态.html-C3Yl6Cnf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—Mapper映射文件配置.html-x9qGtPpC.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—sqlSession执行流程.html-CWxK879o.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—一级缓存实现机制.html-D_LKUttl.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—事务管理机制.html-V89vhtm8.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—二级缓存实现机制.html-BCn599HL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—初始化基本流程.html-bBqkOfuB.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—动态SQL使用与原理.html-DL32eTKP.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—总体框架设计.html-BBU-3Gou.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—插件之分页机制.html-CDFGt0SL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—插件机制.html-8S8TBoEp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—数据源与连接池.html-CEPu9Nf_.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—配置清单.html--XhKRE6S.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MyBatis详解—配置解析过程.html-BFtMLJMU.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Servlet Cookie和Session.html-DR2A0Cc2.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Servlet过滤器.html-C-NQB2b5.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/servlet1.html-DRb571A2.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/servlet2.html-42PPduQR.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/servlet3.html-eov36YBN.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—devtools.html-BXROBh-R.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—常用注解.html-Ba8Tih1P.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—集成Druid连接池.html-CfjBnMCc.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—集成EasyExcel.html-DTvFJSnm.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—集成POI.html-BiH9WmpS.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—集成actuator监控工具.html-BVL5qe48.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot—集成admin监控工具.html-DjQrZ20J.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot集成MyBatis—XML方式.html-CFyiCOLH.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot集成Mybatis—PageHelper分页.html-BLcVZkfP.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/springBoot集成Mybatis—注解方式.html-C8dL65Sg.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringMVC入门.html-C0Ng_82L.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringMVC域对象共享数据.html-CKA3VxTc.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringMVC实现Restful.html-DInf6ncA.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringMVC获取请求参数.html-fa8W1woe.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/SpringMVC视图和视图解析器.html-B3U4PGXL.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/文字特效.html-CWW-bzoz.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 ArrayBuffer.html-2W36NTHK.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 Class.html-D-l69BPD.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 Class的继承.html-BTxqf1fX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 Module的加载实现.html-aBa1Rgt8.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 Module语法.html-BXcB1aqO.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 Set和Map.html-pJ3RLOKS.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 async函数.html-DfIxmzAm.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 let和const.html-BP9Y3Llx.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6 proxy.html-uniH-Ytf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6Iterator和forof循环.html-DTlAuXRp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6Promise对象.html-X0038wAX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6Symbol.html-vhpPuvNp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6函数.html-Walfbb8j.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6字符串.html-DGP1y6Mt.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6对象.html-C9vMcfc3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6数值.html-SmGBY7Dy.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6数组.html-CoksV7eK.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6结构赋值.html-BQ92au-D.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ES6运算符.html-Bs3f4iJZ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/d.ts类型声明文件.html-FaTrqTNS.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts三种特殊类型.html-BRPQpIAI.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts函数类型.html--6E7_dgc.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts对象类型.html-D_srTGKv.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts数据类型.html-DdGu-2OM.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts数组和元组.html-CpSB7IfP.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts泛型.html-CNg_kaja.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts的Enum类型.html-B0prNOGB.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts的interface接口.html-Ck9jEaZi.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ts类型断言.html-D48eOsHa.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-CanvasAPI.html-B6FROLkX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-ClipboardAPI.html-0jgZMKkU.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-FetchAPI.html-Cw8kemav.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-File_FileList_FileReader.html-y4iXaL7r.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-FormData.html-Ce7PdjOD.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-History.html-DGhVAnAu.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-SVG.html-BBglUUsf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-URL.html-OIxMamXE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-URLPatternAPI.html-C0Z9MUp-.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-WebSocket.html-ByF7T6KK.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS-window.html-V5DKdGqJ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/JS实用代码片段.html-Doj17dcN.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Dockerfile定制镜像.html-BqJFqn9-.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Docker基础.html-uLBanoLh.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Docker的数据卷.html-77QNeeko.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Docker的网络.html-B5ZPYRuZ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/docker-compose.html-BSZgYk07.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/热门镜像安装.html-DZX34XX3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/集成Docker实现一键部署.html-1Fb2sueb.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—入门.html-DKt3zrnh.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—函数.html-DhI9gh7d.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—变量.html-BxAscfVJ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—字符串操作.html-CblAJx4i.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—常用命令.html-CUG0uuSR.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—数组.html-B5xdV-o-.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—模式扩展.html-C5iBpyvX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—流程控制.html-DQ0Mltck.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Bash脚本—算数运算.html-dj-lv_1k.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/LinuxSSH命令.html-ZEixwzzn.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/LinuxVim.html-BLR2nTK4.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux入门.html-ChkQ41jS.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux常用软件安装.html-Cnbim67c.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux打包压缩命令.html-BoroE2eH.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux操作历史.html-DWyTTK-y.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux文件目录相关命令.html-CiIm7__W.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux文件系统结构.html-CrEKZlHu.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux文本操作命令.html-dpby_lpV.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux权限管理.html-bnFYZPlz.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux用户和用户组管理.html-BJBnRb6g.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux磁盘相关命令.html-DfAEL6fl.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux系统服务管理.html-BUdwZwBz.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux网络相关命令.html-Cht05aA3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux软件安装.html-C1sIpfsj.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux进程相关命令.html-UEE7xCyV.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linux防火墙详解.html-BmEe5q02.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Linx其它常用命令.html-UiiLkvyg.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/VMware安装linux.html-QKlGqGYf.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/linux常用工具.html-ByzRfgkW.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/安装脚本实例.html-C7RRJ0lE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ansible-playbook.html-DXfEAASm.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ansible.html-88oi0H4U.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/ansible常用模块.html-CMsfTp6D.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/nginx入门.html-Qk3RJvA5.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Requests基本用法.html-B6BIASSQ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Scrapy爬虫框架.html-BqGGmM3t.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/urllib包.html-CoRMY1yu.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL事务.html-Csl-FK9k.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL入门.html-DxbZNXsn.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL基础查询.html-DtPhx34t.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL多表查询.html-C5wfhCu-.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL字符集和校对规则.html-_isALRAV.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL存储引擎.html-hAlOhDuw.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL存储过程.html-CBmiE5Hp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL安装.html-DSTAYqzW.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL常用函数汇总.html-D4XqfSXy.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL常见问题.html-BCBw0sYk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL执行流程.html-Bfg1btkF.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL操作表中的数据.html-BGUDeAQw.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL数据库备份恢复.html-HumVlNWo.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL数据库的基本操作.html-B82VpT7r.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL数据类型.html-BqwApVXp.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL数据表的基本操作.html-B_20RMPW.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL日志.html-94bBpZU9.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL用户管理.html-Cb2HMAiy.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL索引.html-C35luInt.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL约束.html-09BWcaJ7.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL视图.html-Cf5fEmuE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL触发器.html-OdMIFndx.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL试题.html-BRDkSaTE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL运算符.html-lumHpRXZ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL锁机制.html-BtjEv1C3.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/MySQL高级查询.html-65qBiYTk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis Stream.html-Cp8IdQRY.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis发布订阅模式.html-DcqPz2sU.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis基础入门.html-NdtPa-dl.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis基础数据类型.html-B1v0M5Se.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis特殊数据类型.html-DQlbnRMh.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis的键.html-CNvpanbv.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/Redis配置文件.html-CyhfkNKb.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/1.html-DpdH85iE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/404.html-DzRdV6V6.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-D7tXnyZ0.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-b0AWykz7.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-BBMr7hCo.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-9fdm_HkX.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-DuegT34i.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-DklkDajr.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-XChYpJBG.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-D6p1qA0N.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-CHmVJb_t.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-CXAYNa7w.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-C-S1-DbF.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-Cnc2VbWo.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-DFvnKRgy.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-YSycvwyb.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-DpAB-Q-D.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-GGmeWdNo.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-Ck37IaW9.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-ZnTpcma4.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-XeWczNmA.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-BQW6HZIv.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-CrKsaQfz.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-B-3-hgWd.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-C2QDHVvc.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-CrONlmu0.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-BdNQ2gpr.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index.html-Bowp21mE.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/giscus-BZxmVUME.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index-BYq9jyaM.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index-DRWmbcXV.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/index-B9oRC6ej.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/mermaid.esm.min-C4kqu-t4.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/wsq-blog/assets/setupDevtools-7MC2TMWH-CNm3RiJ7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/wsq-blog/" aria-label="带我回家"><img class="vp-nav-logo" src="/wsq-blog/logo.png" alt><!----><!----></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wsq-blog/" aria-label="主页"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:google-home" width="1em" height="1em"></iconify-icon><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="前端"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon>前端<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/js/%E5%9F%BA%E7%A1%80/" aria-label="JS基础"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JS基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/js/es6/" aria-label="ES6"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:es6" width="1em" height="1em"></iconify-icon><!--]-->ES6<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/js/CSS/" aria-label="CSS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:css3" width="1em" height="1em"></iconify-icon><!--]-->CSS<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon>Java<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/java/java%E5%9F%BA%E7%A1%80/" aria-label="Java基础"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/java/mybatis/" aria-label="Mybatis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Mybatis<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/wsq-blog/java/Spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/java/springBoot/" aria-label="springBoot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->springBoot<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:azuresqldatabase" width="1em" height="1em"></iconify-icon>SQL<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/sql/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/sql/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql-wordmark" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="运维"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:centos" width="1em" height="1em"></iconify-icon>运维<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/linux/linux%E5%9F%BA%E7%A1%80/" aria-label="linux基础"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->linux基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/linux/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/linux/tools/" aria-label="运维工具"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->运维工具<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="计算机基础"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:windows11" width="1em" height="1em"></iconify-icon>计算机基础<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/network/" aria-label="网络"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:networkx" width="1em" height="1em"></iconify-icon><!--]-->网络<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/wsq-blog/computer/" aria-label="其他"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:haskell" width="1em" height="1em"></iconify-icon><!--]-->其他<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://0oWSQo0.github.com" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90%E5%BC%95%E5%85%A5Spring%E8%A6%81%E7%82%B9.html" aria-label="Spring详解—简单例子引入Spring要点"><!---->Spring详解—简单例子引入Spring要点<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/SpringJdbcTemplate.html" aria-label="/java/Spring/SpringJdbcTemplate.html"><!---->/java/Spring/SpringJdbcTemplate.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E4%BA%8B%E5%8A%A1.html" aria-label="/java/Spring/Spring%E4%BA%8B%E5%8A%A1.html"><!---->/java/Spring/Spring%E4%BA%8B%E5%8A%A1.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E7%9A%84%E6%95%B4%E4%BD%93%E8%84%89%E7%BB%9C.html" aria-label="/java/Spring/Spring%E7%9A%84%E6%95%B4%E4%BD%93%E8%84%89%E7%BB%9C.html"><!---->/java/Spring/Spring%E7%9A%84%E6%95%B4%E4%BD%93%E8%84%89%E7%BB%9C.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html" aria-label="/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html"><!---->/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.html" aria-label="/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.html"><!---->/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B.html<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BBean%E5%AE%9E%E4%BE%8B%E5%8C%96.html" aria-label="Spring为什么不能解决prototype作用域循环依赖？"><!---->Spring为什么不能解决prototype作用域循环依赖？<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94Spring%E5%92%8CSpring%E6%A1%86%E6%9E%B6%E7%BB%84%E6%88%90.html" aria-label="什么是Spring?"><!---->什么是Spring?<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%ACIOC.html" aria-label="引入"><!---->引入<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B(AOP).html" aria-label="引入"><!---->引入<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://0oWSQo0.github.com" target="_blank" rel="noopener noreferrer">WSQ</a></span><span property="author" content="WSQ"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024年11月1日</span><meta property="datePublished" content="2024-11-01T01:55:29.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#如何将bean从xml配置中解析后放到ioc容器中的">如何将Bean从XML配置中解析后放到IoC容器中的？</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#初始化的入口">初始化的入口</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#设置资源解析器和环境">设置资源解析器和环境</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#设置配置路径">设置配置路径</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#初始化的主体流程">初始化的主体流程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><p>我们看下源码的实现：Spring 如何实现将资源配置（以<code>xml</code>配置为例）通过加载，解析，生成<code>BeanDefination</code>并注册到 IoC 容器中的（圈出来的部分）。</p><figure><img src="/wsq-blog/assets/spring-framework-ioc-source-73-xi4WYr6n.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="如何将bean从xml配置中解析后放到ioc容器中的" tabindex="-1"><a class="header-anchor" href="#如何将bean从xml配置中解析后放到ioc容器中的"><span>如何将Bean从XML配置中解析后放到IoC容器中的？</span></a></h2><h3 id="初始化的入口" tabindex="-1"><a class="header-anchor" href="#初始化的入口"><span>初始化的入口</span></a></h3><p>对于<code>xml</code>配置的 Spring 应用，在<code>main()</code>方法中实例化<code>ClasspathXmlApplicationContext</code>即可创建一个 IoC 容器。我们可以从这个构造方法开始，探究一下 IoC 容器的初始化过程。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">// create and configure beans</span></span>
<span class="line"><span style="color:#F0F3F6;">ApplicationContext</span><span style="color:#F0F3F6;"> context</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> ClassPathXmlApplicationContext</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;aspects.xml&quot;</span><span style="color:#F0F3F6;">, </span><span style="color:#ADDCFF;">&quot;daos.xml&quot;</span><span style="color:#F0F3F6;">, </span><span style="color:#ADDCFF;">&quot;services.xml&quot;</span><span style="color:#F0F3F6;">);</span></span></code></pre></div><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">public</span><span style="color:#DBB7FF;"> ClassPathXmlApplicationContext</span><span style="color:#F0F3F6;">(String... configLocations) throws BeansException {</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">(configLocations, </span><span style="color:#91CBFF;">true</span><span style="color:#F0F3F6;">, (ApplicationContext)</span><span style="color:#91CBFF;">null</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#DBB7FF;"> ClassPathXmlApplicationContext</span><span style="color:#F0F3F6;">(</span><span style="color:#FF9492;">String</span><span style="color:#F0F3F6;">[] configLocations, </span><span style="color:#FF9492;">boolean</span><span style="color:#F0F3F6;"> refresh, @</span><span style="color:#FF9492;">Nullable</span><span style="color:#F0F3F6;"> ApplicationContext parent) throws BeansException {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 设置Bean资源加载器</span></span>
<span class="line"><span style="color:#91CBFF;">    super</span><span style="color:#F0F3F6;">(parent);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 设置配置路径</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">setConfigLocations</span><span style="color:#F0F3F6;">(configLocations);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 初始化容器</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (refresh) {</span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">refresh</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h2 id="设置资源解析器和环境" tabindex="-1"><a class="header-anchor" href="#设置资源解析器和环境"><span>设置资源解析器和环境</span></a></h2><p>调用父类容器<code>AbstractApplicationContext</code>的构造方法(<code>super(parent)</code>方法)为容器设置好<code>Bean</code>资源加载器。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">public</span><span style="color:#DBB7FF;"> AbstractApplicationContext</span><span style="color:#F0F3F6;">(@</span><span style="color:#FF9492;">Nullable</span><span style="color:#F0F3F6;"> ApplicationContext parent) {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 默认构造函数初始化容器id, name, 状态 以及 资源解析器</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 将父容器的Environment合并到当前容器</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">setParent</span><span style="color:#F0F3F6;">(parent);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>通过<code>AbstractApplicationContext</code>默认构造函数初始化容器<code>id, name</code>，状态以及资源解析器。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">public</span><span style="color:#DBB7FF;"> AbstractApplicationContext</span><span style="color:#F0F3F6;">() {</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.logger </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> LogFactory.</span><span style="color:#DBB7FF;">getLog</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">getClass</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.id </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> ObjectUtils.</span><span style="color:#DBB7FF;">identityToString</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.displayName </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> ObjectUtils.</span><span style="color:#DBB7FF;">identityToString</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.beanFactoryPostProcessors </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> ArrayList</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.active </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> AtomicBoolean</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.closed </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> AtomicBoolean</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.startupShutdownMonitor </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> Object</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.applicationStartup </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> ApplicationStartup.DEFAULT;</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.applicationListeners </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> LinkedHashSet</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.resourcePatternResolver </span><span style="color:#FF9492;">=</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">getResourcePatternResolver</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"><span style="color:#BDC4CC;">// Spring资源加载器</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> ResourcePatternResolver </span><span style="color:#DBB7FF;">getResourcePatternResolver</span><span style="color:#F0F3F6;">() {</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> PathMatchingResourcePatternResolver</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>通过<code>AbstractApplicationContext的setParent(parent)</code>方法将父容器的<code>Environment</code>合并到当前容器。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> setParent</span><span style="color:#F0F3F6;">(@</span><span style="color:#FF9492;">Nullable</span><span style="color:#F0F3F6;"> ApplicationContext parent) {</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.parent </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> parent;</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (parent </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        Environment</span><span style="color:#F0F3F6;"> parentEnvironment</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> parent.</span><span style="color:#DBB7FF;">getEnvironment</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (parentEnvironment </span><span style="color:#FF9492;">instanceof</span><span style="color:#F0F3F6;"> ConfigurableEnvironment) {</span></span>
<span class="line"><span style="color:#91CBFF;">            this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">getEnvironment</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">merge</span><span style="color:#F0F3F6;">((ConfigurableEnvironment)parentEnvironment);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h3 id="设置配置路径" tabindex="-1"><a class="header-anchor" href="#设置配置路径"><span>设置配置路径</span></a></h3><p>在设置容器的资源加载器之后，接下来<code>FileSystemXmlApplicationContet</code>执行<code>setConfigLocations</code>方法通过调用其父类<code>AbstractRefreshableConfigApplicationContext</code>的方法进行对<code>Bean</code>定义资源文件的定位。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> setConfigLocations</span><span style="color:#F0F3F6;">(@</span><span style="color:#FF9492;">Nullable</span><span style="color:#F0F3F6;"> String... locations) {</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (locations </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        Assert.</span><span style="color:#DBB7FF;">noNullElements</span><span style="color:#F0F3F6;">(locations, </span><span style="color:#ADDCFF;">&quot;Config locations must not be null&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.configLocations </span><span style="color:#FF9492;">=</span><span style="color:#FF9492;"> new</span><span style="color:#FF9492;"> String</span><span style="color:#F0F3F6;">[locations.length];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">        for</span><span style="color:#F0F3F6;">(</span><span style="color:#FF9492;">int</span><span style="color:#F0F3F6;"> i</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> 0</span><span style="color:#F0F3F6;">; i </span><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;"> locations.length; </span><span style="color:#FF9492;">++</span><span style="color:#F0F3F6;">i) {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // 解析配置路径</span></span>
<span class="line"><span style="color:#91CBFF;">            this</span><span style="color:#F0F3F6;">.configLocations[i] </span><span style="color:#FF9492;">=</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">resolvePath</span><span style="color:#F0F3F6;">(locations[i]).</span><span style="color:#DBB7FF;">trim</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    } </span><span style="color:#FF9492;">else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.configLocations </span><span style="color:#FF9492;">=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> String </span><span style="color:#DBB7FF;">resolvePath</span><span style="color:#F0F3F6;">(String path) {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 从上一步Environment中解析</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">getEnvironment</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">resolveRequiredPlaceholders</span><span style="color:#F0F3F6;">(path);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h3 id="初始化的主体流程" tabindex="-1"><a class="header-anchor" href="#初始化的主体流程"><span>初始化的主体流程</span></a></h3><p>Spring IoC 容器对<code>Bean</code>定义资源的载入是从<code>refresh()</code>函数开始的，<code>refresh()</code>是一个模板方法，<code>refresh()</code>方法的作用是：在创建 IoC 容器前，如果已经有容器存在，则需要把已有的容器销毁和关闭，以保证在<code>refresh</code>之后使用的是新建立起来的 IoC 容器。<code>refresh</code>的作用类似于对 IoC 容器的重启，在新建立好的容器中对容器进行初始化，对<code>Bean</code>定义资源进行载入。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">Override</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> refresh</span><span style="color:#F0F3F6;">() throws BeansException, IllegalStateException {</span></span>
<span class="line"><span style="color:#FF9492;">    synchronized</span><span style="color:#F0F3F6;"> (</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.startupShutdownMonitor) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        StartupStep</span><span style="color:#F0F3F6;"> contextRefresh</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.applicationStartup.</span><span style="color:#DBB7FF;">start</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;spring.context.refresh&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">        // Prepare this context for refreshing.</span></span>
<span class="line"><span style="color:#DBB7FF;">        prepareRefresh</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">        // Tell the subclass to refresh the internal bean factory.</span></span>
<span class="line"><span style="color:#F0F3F6;">        ConfigurableListableBeanFactory</span><span style="color:#F0F3F6;"> beanFactory</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> obtainFreshBeanFactory</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">        // Prepare the bean factory for use in this context.</span></span>
<span class="line"><span style="color:#DBB7FF;">        prepareBeanFactory</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">        try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Allows post-processing of the bean factory in context subclasses.</span></span>
<span class="line"><span style="color:#DBB7FF;">            postProcessBeanFactory</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">            StartupStep</span><span style="color:#F0F3F6;"> beanPostProcess</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.applicationStartup.</span><span style="color:#DBB7FF;">start</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;spring.context.beans.post-process&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Invoke factory processors registered as beans in the context.</span></span>
<span class="line"><span style="color:#DBB7FF;">            invokeBeanFactoryPostProcessors</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Register bean processors that intercept bean creation.</span></span>
<span class="line"><span style="color:#DBB7FF;">            registerBeanPostProcessors</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"><span style="color:#F0F3F6;">            beanPostProcess.</span><span style="color:#DBB7FF;">end</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Initialize message source for this context.</span></span>
<span class="line"><span style="color:#DBB7FF;">            initMessageSource</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Initialize event multicaster for this context.</span></span>
<span class="line"><span style="color:#DBB7FF;">            initApplicationEventMulticaster</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Initialize other special beans in specific context subclasses.</span></span>
<span class="line"><span style="color:#DBB7FF;">            onRefresh</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Check for listener beans and register them.</span></span>
<span class="line"><span style="color:#DBB7FF;">            registerListeners</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Instantiate all remaining (non-lazy-init) singletons.</span></span>
<span class="line"><span style="color:#DBB7FF;">            finishBeanFactoryInitialization</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Last step: publish corresponding event.</span></span>
<span class="line"><span style="color:#DBB7FF;">            finishRefresh</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">        catch</span><span style="color:#F0F3F6;"> (BeansException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isWarnEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                logger.</span><span style="color:#DBB7FF;">warn</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Exception encountered during context initialization - &quot;</span><span style="color:#FF9492;"> +</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;cancelling refresh attempt: &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Destroy already created singletons to avoid dangling resources.</span></span>
<span class="line"><span style="color:#DBB7FF;">            destroyBeans</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Reset &#39;active&#39; flag.</span></span>
<span class="line"><span style="color:#DBB7FF;">            cancelRefresh</span><span style="color:#F0F3F6;">(ex);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">            // Propagate exception to caller.</span></span>
<span class="line"><span style="color:#FF9492;">            throw</span><span style="color:#F0F3F6;"> ex;</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">        finally</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Reset common introspection caches in Spring&#39;s core, since we</span></span>
<span class="line"><span style="color:#BDC4CC;">            // might not ever need metadata for singleton beans anymore...</span></span>
<span class="line"><span style="color:#DBB7FF;">            resetCommonCaches</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">            contextRefresh.</span><span style="color:#DBB7FF;">end</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>这里的设计上是一个非常典型的资源类加载处理型的思路，头脑中需要形成如下图的顶层思路：</p><ul><li>模板方法设计模式，模板方法中使用典型的钩子方法</li><li>将具体的初始化加载方法插入到钩子方法之间</li><li>将初始化的阶段封装，用来记录当前初始化到什么阶段；常见的设计是<code>xxxPhase/xxxStage</code></li><li>资源加载初始化有失败等处理，必然是<code>try/catch/finally...</code></li></ul><figure><img src="/wsq-blog/assets/spring-framework-ioc-source-8-DQ4P_zUk.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="初始化beanfactory之obtainfreshbeanfactory" tabindex="-1"><a class="header-anchor" href="#初始化beanfactory之obtainfreshbeanfactory"><span>初始化BeanFactory之obtainFreshBeanFactory</span></a></h4><p><code>AbstractApplicationContext</code>的<code>obtainFreshBeanFactory()</code>方法调用子类容器的<code>refreshBeanFactory()</code>方法，启动容器载入<code>Bean</code>定义资源文件的过程，代码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> ConfigurableListableBeanFactory </span><span style="color:#DBB7FF;">obtainFreshBeanFactory</span><span style="color:#F0F3F6;">() {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 这里使用了委派设计模式，父类定义了抽象的refreshBeanFactory()方法，具体实现调用子类容器的refreshBeanFactory()方法</span></span>
<span class="line"><span style="color:#DBB7FF;">    refreshBeanFactory</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#DBB7FF;"> getBeanFactory</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p><code>AbstractApplicationContext</code>类中只抽象定义了<code>refreshBeanFactory()</code>方法，容器真正调用的是其子类<code>AbstractRefreshableApplicationContext</code>实现的<code>refreshBeanFactory()</code>方法; 在创建 IoC 容器前，如果已经有容器存在，则需要把已有的容器销毁和关闭，以保证在<code>refresh</code>之后使用的是新建立起来的 IoC 容器。方法的源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> final</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> refreshBeanFactory</span><span style="color:#F0F3F6;">() throws BeansException {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果已经有容器存在，则需要把已有的容器销毁和关闭，以保证在refresh之后使用的是新建立起来的IoC容器</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (</span><span style="color:#DBB7FF;">hasBeanFactory</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        destroyBeans</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#DBB7FF;">        closeBeanFactory</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">        // 创建DefaultListableBeanFactory，并调用loadBeanDefinitions(beanFactory)装载bean定义</span></span>
<span class="line"><span style="color:#F0F3F6;">        DefaultListableBeanFactory</span><span style="color:#F0F3F6;"> beanFactory</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> createBeanFactory</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">        beanFactory.</span><span style="color:#DBB7FF;">setSerializationId</span><span style="color:#F0F3F6;">(</span><span style="color:#DBB7FF;">getId</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#DBB7FF;">        customizeBeanFactory</span><span style="color:#F0F3F6;">(beanFactory); </span><span style="color:#BDC4CC;">// 对IoC容器进行定制化，如设置启动参数，开启注解的自动装配等 </span></span>
<span class="line"><span style="color:#DBB7FF;">        loadBeanDefinitions</span><span style="color:#F0F3F6;">(beanFactory); </span><span style="color:#BDC4CC;">// 调用载入Bean定义的方法，主要这里又使用了一个委派模式，在当前类中只定义了抽象的loadBeanDefinitions方法，具体的实现调用子类容器  </span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.beanFactory </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> beanFactory;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (IOException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> ApplicationContextException</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;I/O error parsing bean definition source for &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#DBB7FF;"> getDisplayName</span><span style="color:#F0F3F6;">(), ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h4 id="初始化beanfactory之loadbeandefinitions" tabindex="-1"><a class="header-anchor" href="#初始化beanfactory之loadbeandefinitions"><span>初始化BeanFactory之loadBeanDefinitions</span></a></h4><p><code>AbstractRefreshableApplicationContext</code>中只定义了抽象的<code>loadBeanDefinitions</code>方法，容器真正调用的是其子类<code>AbstractXmlApplicationContext</code>对该方法的实现，<code>AbstractXmlApplicationContext</code>的主要源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(DefaultListableBeanFactory beanFactory) throws BeansException, IOException {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 创建XmlBeanDefinitionReader，即创建Bean读取器，并通过回调设置到容器中去，容器使用该读取器读取Bean定义资源  </span></span>
<span class="line"><span style="color:#F0F3F6;">    XmlBeanDefinitionReader</span><span style="color:#F0F3F6;"> beanDefinitionReader</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> XmlBeanDefinitionReader</span><span style="color:#F0F3F6;">(beanFactory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 配置上下文的环境，资源加载器、解析器</span></span>
<span class="line"><span style="color:#F0F3F6;">    beanDefinitionReader.</span><span style="color:#DBB7FF;">setEnvironment</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.</span><span style="color:#DBB7FF;">getEnvironment</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">    beanDefinitionReader.</span><span style="color:#DBB7FF;">setResourceLoader</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">    beanDefinitionReader.</span><span style="color:#DBB7FF;">setEntityResolver</span><span style="color:#F0F3F6;">(</span><span style="color:#FF9492;">new</span><span style="color:#DBB7FF;"> ResourceEntityResolver</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">)); </span><span style="color:#BDC4CC;">// 为Bean读取器设置SAX xml解析器</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 允许子类自行初始化（比如校验机制），并提供真正的加载方法</span></span>
<span class="line"><span style="color:#DBB7FF;">    initBeanDefinitionReader</span><span style="color:#F0F3F6;">(beanDefinitionReader); </span><span style="color:#BDC4CC;">// 当Bean读取器读取Bean定义的Xml资源文件时，启用Xml的校验机制  </span></span>
<span class="line"><span style="color:#DBB7FF;">    loadBeanDefinitions</span><span style="color:#F0F3F6;">(beanDefinitionReader);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(XmlBeanDefinitionReader reader) throws BeansException, IOException {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 加载XML配置方式里的Bean定义的资源</span></span>
<span class="line"><span style="color:#FF9492;">    Resource</span><span style="color:#FFB757;">[] </span><span style="color:#F0F3F6;">configResources</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> getConfigResources</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (configResources </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        reader.</span><span style="color:#DBB7FF;">loadBeanDefinitions</span><span style="color:#F0F3F6;">(configResources);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 加载构造函数里配置的Bean配置文件，即{&quot;aspects.xml&quot;, &quot;daos.xml&quot;, &quot;services.xml&quot;}</span></span>
<span class="line"><span style="color:#FF9492;">    String</span><span style="color:#FFB757;">[] </span><span style="color:#F0F3F6;">configLocations</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> getConfigLocations</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (configLocations </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        reader.</span><span style="color:#DBB7FF;">loadBeanDefinitions</span><span style="color:#F0F3F6;">(configLocations);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>Xml Bean 读取器(<code>XmlBeanDefinitionReader</code>)调用其父类<code>AbstractBeanDefinitionReader</code>的<code>reader.loadBeanDefinitions</code>方法读取<code>Bean</code>定义资源。</p><p>由于我们使用<code>ClassPathXmlApplicationContext</code>作为例子分析，因此<code>getConfigResources</code>的返回值为<code>null</code>，因此程序执行<code>reader.loadBeanDefinitions(configLocations)</code>分支。</p><h4 id="abstractbeandefinitionreader读取bean定义资源" tabindex="-1"><a class="header-anchor" href="#abstractbeandefinitionreader读取bean定义资源"><span>AbstractBeanDefinitionReader读取Bean定义资源</span></a></h4><p><code>AbstractBeanDefinitionReader</code>的<code>loadBeanDefinitions</code>方法源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">Override</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> int</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(String location) throws BeanDefinitionStoreException {</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(location, </span><span style="color:#91CBFF;">null</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> int</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(String location, @</span><span style="color:#FF9492;">Nullable</span><span style="color:#F0F3F6;"> Set</span><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;">Resource</span><span style="color:#FF9492;">&gt;</span><span style="color:#F0F3F6;"> actualResources) throws BeanDefinitionStoreException {</span></span>
<span class="line"><span style="color:#F0F3F6;">    ResourceLoader</span><span style="color:#F0F3F6;"> resourceLoader</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> getResourceLoader</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (resourceLoader </span><span style="color:#FF9492;">==</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;Cannot load bean definitions from location [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> location </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]: no ResourceLoader available&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 模式匹配类型的解析器，这种方式是加载多个满足匹配条件的资源</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (resourceLoader </span><span style="color:#FF9492;">instanceof</span><span style="color:#F0F3F6;"> ResourcePatternResolver) {</span></span>
<span class="line"><span style="color:#FF9492;">        try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // 获取到要加载的资源</span></span>
<span class="line"><span style="color:#FF9492;">            Resource</span><span style="color:#FFB757;">[] </span><span style="color:#F0F3F6;">resources</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> ((ResourcePatternResolver) resourceLoader).</span><span style="color:#DBB7FF;">getResources</span><span style="color:#F0F3F6;">(location);</span></span>
<span class="line"><span style="color:#FF9492;">            int</span><span style="color:#F0F3F6;"> count</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(resources); </span><span style="color:#BDC4CC;">// 委派调用其子类XmlBeanDefinitionReader的方法，实现加载功能  </span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (actualResources </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                Collections.</span><span style="color:#DBB7FF;">addAll</span><span style="color:#F0F3F6;">(actualResources, resources);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isTraceEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                logger.</span><span style="color:#DBB7FF;">trace</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Loaded &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> count </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; bean definitions from location pattern [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> location </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#FF9492;">            return</span><span style="color:#F0F3F6;"> count;</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        catch</span><span style="color:#F0F3F6;"> (IOException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">            throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(</span></span>
<span class="line"><span style="color:#ADDCFF;">                    &quot;Could not resolve bean definition resource pattern [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> location </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">        // 只能通过绝对路径URL加载单个资源.</span></span>
<span class="line"><span style="color:#F0F3F6;">        Resource</span><span style="color:#F0F3F6;"> resource</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> resourceLoader.</span><span style="color:#DBB7FF;">getResource</span><span style="color:#F0F3F6;">(location);</span></span>
<span class="line"><span style="color:#FF9492;">        int</span><span style="color:#F0F3F6;"> count</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> loadBeanDefinitions</span><span style="color:#F0F3F6;">(resource);</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (actualResources </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">            actualResources.</span><span style="color:#DBB7FF;">add</span><span style="color:#F0F3F6;">(resource);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isTraceEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">            logger.</span><span style="color:#DBB7FF;">trace</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Loaded &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> count </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; bean definitions from location [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> location </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        return</span><span style="color:#F0F3F6;"> count;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>从对<code>AbstractBeanDefinitionReader</code>的<code>loadBeanDefinitions</code>方法源码分析可以看出该方法做了以下两件事：</p><ul><li>首先，调用资源加载器的获取资源方法<code>resourceLoader.getResource(location)</code>，获取到要加载的资源。</li><li>其次，真正执行加载功能是其子类<code>XmlBeanDefinitionReader的loadBeanDefinitions</code>方法。</li></ul><h4 id="xmlbeandefinitionreader加载bean定义资源" tabindex="-1"><a class="header-anchor" href="#xmlbeandefinitionreader加载bean定义资源"><span>XmlBeanDefinitionReader加载Bean定义资源</span></a></h4><p>继续看子类<code>XmlBeanDefinitionReader的loadBeanDefinitions(Resource …)</code>方法看到代表<code>bean</code>文件的资源定义以后的载入过程。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">/**</span></span>
<span class="line"><span style="color:#BDC4CC;">    * 本质上是加载XML配置的Bean。</span></span>
<span class="line"><span style="color:#BDC4CC;">    * </span><span style="color:#FF9492;">@param</span><span style="color:#FFB757;"> inputSource</span><span style="color:#BDC4CC;"> the SAX InputSource to read from</span></span>
<span class="line"><span style="color:#BDC4CC;">    * </span><span style="color:#FF9492;">@param</span><span style="color:#FFB757;"> resource</span><span style="color:#BDC4CC;"> the resource descriptor for the XML file</span></span>
<span class="line"><span style="color:#BDC4CC;">    */</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> int</span><span style="color:#DBB7FF;"> doLoadBeanDefinitions</span><span style="color:#F0F3F6;">(InputSource inputSource, Resource resource)</span></span>
<span class="line"><span style="color:#F0F3F6;">        throws BeanDefinitionStoreException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">    try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#F0F3F6;">        Document</span><span style="color:#F0F3F6;"> doc</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> doLoadDocument</span><span style="color:#F0F3F6;">(inputSource, resource); </span><span style="color:#BDC4CC;">// 将Bean定义资源转换成Document对象</span></span>
<span class="line"><span style="color:#FF9492;">        int</span><span style="color:#F0F3F6;"> count</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> registerBeanDefinitions</span><span style="color:#F0F3F6;">(doc, resource);</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isDebugEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">            logger.</span><span style="color:#DBB7FF;">debug</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Loaded &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> count </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; bean definitions from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        return</span><span style="color:#F0F3F6;"> count;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (BeanDefinitionStoreException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#F0F3F6;"> ex;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (SAXParseException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> XmlBeanDefinitionStoreException</span><span style="color:#F0F3F6;">(resource.</span><span style="color:#DBB7FF;">getDescription</span><span style="color:#F0F3F6;">(),</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;Line &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> ex.</span><span style="color:#DBB7FF;">getLineNumber</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; in XML document from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; is invalid&quot;</span><span style="color:#F0F3F6;">, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (SAXException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> XmlBeanDefinitionStoreException</span><span style="color:#F0F3F6;">(resource.</span><span style="color:#DBB7FF;">getDescription</span><span style="color:#F0F3F6;">(),</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;XML document from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot; is invalid&quot;</span><span style="color:#F0F3F6;">, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (ParserConfigurationException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(resource.</span><span style="color:#DBB7FF;">getDescription</span><span style="color:#F0F3F6;">(),</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;Parser configuration exception parsing XML from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (IOException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(resource.</span><span style="color:#DBB7FF;">getDescription</span><span style="color:#F0F3F6;">(),</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;IOException parsing XML document from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    catch</span><span style="color:#F0F3F6;"> (Throwable </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(resource.</span><span style="color:#DBB7FF;">getDescription</span><span style="color:#F0F3F6;">(),</span></span>
<span class="line"><span style="color:#ADDCFF;">                &quot;Unexpected exception parsing XML document from &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> resource, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">// 使用配置的DocumentLoader加载XML定义文件为Document.</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> Document </span><span style="color:#DBB7FF;">doLoadDocument</span><span style="color:#F0F3F6;">(InputSource inputSource, Resource resource) throws Exception {</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.documentLoader.</span><span style="color:#DBB7FF;">loadDocument</span><span style="color:#F0F3F6;">(inputSource, </span><span style="color:#DBB7FF;">getEntityResolver</span><span style="color:#F0F3F6;">(), </span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.errorHandler,</span></span>
<span class="line"><span style="color:#DBB7FF;">            getValidationModeForResource</span><span style="color:#F0F3F6;">(resource), </span><span style="color:#DBB7FF;">isNamespaceAware</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>通过源码分析，载入<code>Bean</code>定义资源文件的最后一步是将<code>Bean</code>定义资源转换为<code>Document</code>对象，该过程由<code>documentLoader</code>实现</p><h4 id="documentloader将bean定义资源转换为document对象" tabindex="-1"><a class="header-anchor" href="#documentloader将bean定义资源转换为document对象"><span>DocumentLoader将Bean定义资源转换为Document对象</span></a></h4><p><code>DocumentLoader</code>将<code>Bean</code>定义资源转换成<code>Document</code>对象的源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">// 使用标准的JAXP将载入的Bean定义资源转换成document对象</span></span>
<span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">Override</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#F0F3F6;"> Document </span><span style="color:#DBB7FF;">loadDocument</span><span style="color:#F0F3F6;">(InputSource inputSource, EntityResolver entityResolver,</span></span>
<span class="line"><span style="color:#F0F3F6;">        ErrorHandler errorHandler, </span><span style="color:#FF9492;">int</span><span style="color:#F0F3F6;"> validationMode, </span><span style="color:#FF9492;">boolean</span><span style="color:#F0F3F6;"> namespaceAware) throws Exception {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 创建文件解析器工厂</span></span>
<span class="line"><span style="color:#F0F3F6;">    DocumentBuilderFactory</span><span style="color:#F0F3F6;"> factory</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> createDocumentBuilderFactory</span><span style="color:#F0F3F6;">(validationMode, namespaceAware);</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isTraceEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        logger.</span><span style="color:#DBB7FF;">trace</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Using JAXP provider [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> factory.</span><span style="color:#DBB7FF;">getClass</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getName</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 创建文档解析器</span></span>
<span class="line"><span style="color:#F0F3F6;">    DocumentBuilder</span><span style="color:#F0F3F6;"> builder</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> createDocumentBuilder</span><span style="color:#F0F3F6;">(factory, entityResolver, errorHandler);</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#F0F3F6;"> builder.</span><span style="color:#DBB7FF;">parse</span><span style="color:#F0F3F6;">(inputSource); </span><span style="color:#BDC4CC;">// 解析</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> DocumentBuilderFactory </span><span style="color:#DBB7FF;">createDocumentBuilderFactory</span><span style="color:#F0F3F6;">(</span><span style="color:#FF9492;">int</span><span style="color:#F0F3F6;"> validationMode, </span><span style="color:#FF9492;">boolean</span><span style="color:#F0F3F6;"> namespaceAware)</span></span>
<span class="line"><span style="color:#F0F3F6;">        throws ParserConfigurationException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">    DocumentBuilderFactory</span><span style="color:#F0F3F6;"> factory</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> DocumentBuilderFactory.</span><span style="color:#DBB7FF;">newInstance</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">    factory.</span><span style="color:#DBB7FF;">setNamespaceAware</span><span style="color:#F0F3F6;">(namespaceAware);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // 设置解析XML的校验</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (validationMode </span><span style="color:#FF9492;">!=</span><span style="color:#F0F3F6;"> XmlValidationModeDetector.VALIDATION_NONE) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        factory.</span><span style="color:#DBB7FF;">setValidating</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">true</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (validationMode </span><span style="color:#FF9492;">==</span><span style="color:#F0F3F6;"> XmlValidationModeDetector.VALIDATION_XSD) {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Enforce namespace aware for XSD...</span></span>
<span class="line"><span style="color:#F0F3F6;">            factory.</span><span style="color:#DBB7FF;">setNamespaceAware</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">true</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#FF9492;">            try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#F0F3F6;">                factory.</span><span style="color:#DBB7FF;">setAttribute</span><span style="color:#F0F3F6;">(SCHEMA_LANGUAGE_ATTRIBUTE, XSD_SCHEMA_LANGUAGE);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#FF9492;">            catch</span><span style="color:#F0F3F6;"> (IllegalArgumentException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                ParserConfigurationException</span><span style="color:#F0F3F6;"> pcex</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> ParserConfigurationException</span><span style="color:#F0F3F6;">(</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;Unable to validate using XSD: Your JAXP provider [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> factory </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;] does not support XML Schema. Are you running on Java 1.4 with Apache Crimson? &quot;</span><span style="color:#FF9492;"> +</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;Upgrade to Apache Xerces (or Java 1.5) for full XSD support.&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">                pcex.</span><span style="color:#DBB7FF;">initCause</span><span style="color:#F0F3F6;">(ex);</span></span>
<span class="line"><span style="color:#FF9492;">                throw</span><span style="color:#F0F3F6;"> pcex;</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#F0F3F6;"> factory;</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>该解析过程调用JavaEE标准的JAXP标准进行处理。</p><p>至此 Spring IoC 容器根据定位的<code>Bean</code>定义资源文件，将其加载读入并转换成为<code>Document</code>对象过程完成。</p><p>接下来我们要继续分析 Spring IoC 容器将载入的<code>Bean</code>定义资源文件转换为<code>Document</code>对象之后，是如何将其解析为 Spring IoC 管理的<code>Bean</code>对象并将其注册到容器中的。</p><h4 id="xmlbeandefinitionreader解析载入的bean定义资源文件" tabindex="-1"><a class="header-anchor" href="#xmlbeandefinitionreader解析载入的bean定义资源文件"><span>XmlBeanDefinitionReader解析载入的Bean定义资源文件</span></a></h4><p><code>XmlBeanDefinitionReader</code>类中的<code>doLoadBeanDefinitions</code>方法是从特定 XML 文件中实际载入<code>Bean</code>定义资源的方法，该方法在载入<code>Bean</code>定义资源之后将其转换为<code>Document</code>对象，接下来调用<code>registerBeanDefinitions</code>启动 Spring IoC 容器对<code>Bean</code>定义的解析过程，<code>registerBeanDefinitions</code>方法源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">// 按照Spring的Bean语义要求将Bean定义资源解析并转换为容器内部数据结构 </span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> int</span><span style="color:#DBB7FF;"> registerBeanDefinitions</span><span style="color:#F0F3F6;">(Document doc, Resource resource) throws BeanDefinitionStoreException {</span></span>
<span class="line"><span style="color:#F0F3F6;">    BeanDefinitionDocumentReader</span><span style="color:#F0F3F6;"> documentReader</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> createBeanDefinitionDocumentReader</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    int</span><span style="color:#F0F3F6;"> countBefore</span><span style="color:#FF9492;"> =</span><span style="color:#DBB7FF;"> getRegistry</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getBeanDefinitionCount</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 解析过程入口，这里使用了委派模式，具体的解析实现过程有实现类DefaultBeanDefinitionDocumentReader完成  </span></span>
<span class="line"><span style="color:#F0F3F6;">    documentReader.</span><span style="color:#DBB7FF;">registerBeanDefinitions</span><span style="color:#F0F3F6;">(doc, </span><span style="color:#DBB7FF;">createReaderContext</span><span style="color:#F0F3F6;">(resource));</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#DBB7FF;"> getRegistry</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getBeanDefinitionCount</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">-</span><span style="color:#F0F3F6;"> countBefore;  </span><span style="color:#BDC4CC;">// 返回此次解析了多少个对象</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">// 创建BeanDefinitionDocumentReader对象，解析Document对象  </span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#F0F3F6;"> BeanDefinitionDocumentReader </span><span style="color:#DBB7FF;">createBeanDefinitionDocumentReader</span><span style="color:#F0F3F6;">() {</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#F0F3F6;"> BeanUtils.</span><span style="color:#DBB7FF;">instantiateClass</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.documentReaderClass);</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">/**</span></span>
<span class="line"><span style="color:#BDC4CC;">    * Create the {@link XmlReaderContext} to pass over to the document reader.</span></span>
<span class="line"><span style="color:#BDC4CC;">    */</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#F0F3F6;"> XmlReaderContext </span><span style="color:#DBB7FF;">createReaderContext</span><span style="color:#F0F3F6;">(Resource resource) {</span></span>
<span class="line"><span style="color:#FF9492;">    return</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> XmlReaderContext</span><span style="color:#F0F3F6;">(resource, </span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.problemReporter, </span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.eventListener,</span></span>
<span class="line"><span style="color:#91CBFF;">            this</span><span style="color:#F0F3F6;">.sourceExtractor, </span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">, </span><span style="color:#DBB7FF;">getNamespaceHandlerResolver</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p><code>Bean</code>定义资源的载入解析分为以下两个过程：</p><ul><li>首先，通过调用 XML 解析器将<code>Bean</code>定义资源文件转换得到<code>Document</code>对象，但是这些<code>Document</code>对象并没有按照 Spring 的<code>Bean</code>规则进行解析。这一步是载入的过程</li><li>其次，在完成通用的 XML 解析之后，按照 Spring 的<code>Bean</code>规则对<code>Document</code>对象进行解析。</li></ul><p>按照 Spring 的<code>Bean</code>规则对<code>Document</code>对象解析的过程是在接口<code>BeanDefinitionDocumentReader</code>的实现类<code>DefaultBeanDefinitionDocumentReader</code>中实现的。</p><h4 id="defaultbeandefinitiondocumentreader对bean定义的document对象解析" tabindex="-1"><a class="header-anchor" href="#defaultbeandefinitiondocumentreader对bean定义的document对象解析"><span>DefaultBeanDefinitionDocumentReader对Bean定义的Document对象解析</span></a></h4><p><code>BeanDefinitionDocumentReader</code>接口通过<code>registerBeanDefinitions</code>方法调用其实现类<code>DefaultBeanDefinitionDocumentReader</code>对<code>Document</code>对象进行解析，解析的代码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">Override</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> registerBeanDefinitions</span><span style="color:#F0F3F6;">(Document doc, XmlReaderContext readerContext) {</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.readerContext </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> readerContext;</span></span>
<span class="line"><span style="color:#DBB7FF;">    doRegisterBeanDefinitions</span><span style="color:#F0F3F6;">(doc.</span><span style="color:#DBB7FF;">getDocumentElement</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">// 注册&lt;beans/&gt;配置的Beans</span></span>
<span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">SuppressWarnings</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;deprecation&quot;</span><span style="color:#F0F3F6;">)  </span><span style="color:#BDC4CC;">// for Environment.acceptsProfiles(String...)</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> doRegisterBeanDefinitions</span><span style="color:#F0F3F6;">(Element root) {</span></span>
<span class="line"><span style="color:#BDC4CC;">    // Any nested &lt;beans&gt; elements will cause recursion in this method. In</span></span>
<span class="line"><span style="color:#BDC4CC;">    // order to propagate and preserve &lt;beans&gt; default-* attributes correctly,</span></span>
<span class="line"><span style="color:#BDC4CC;">    // keep track of the current (parent) delegate, which may be null. Create</span></span>
<span class="line"><span style="color:#BDC4CC;">    // the new (child) delegate with a reference to the parent for fallback purposes,</span></span>
<span class="line"><span style="color:#BDC4CC;">    // then ultimately reset this.delegate back to its original (parent) reference.</span></span>
<span class="line"><span style="color:#BDC4CC;">    // this behavior emulates a stack of delegates without actually necessitating one.</span></span>
<span class="line"><span style="color:#F0F3F6;">    BeanDefinitionParserDelegate</span><span style="color:#F0F3F6;"> parent</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.delegate;</span></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.delegate </span><span style="color:#FF9492;">=</span><span style="color:#DBB7FF;"> createDelegate</span><span style="color:#F0F3F6;">(</span><span style="color:#DBB7FF;">getReaderContext</span><span style="color:#F0F3F6;">(), root, parent);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.delegate.</span><span style="color:#DBB7FF;">isDefaultNamespace</span><span style="color:#F0F3F6;">(root)) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        String</span><span style="color:#F0F3F6;"> profileSpec</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> root.</span><span style="color:#DBB7FF;">getAttribute</span><span style="color:#F0F3F6;">(PROFILE_ATTRIBUTE);</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (StringUtils.</span><span style="color:#DBB7FF;">hasText</span><span style="color:#F0F3F6;">(profileSpec)) {</span></span>
<span class="line"><span style="color:#FF9492;">            String</span><span style="color:#FFB757;">[] </span><span style="color:#F0F3F6;">specifiedProfiles</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> StringUtils.</span><span style="color:#DBB7FF;">tokenizeToStringArray</span><span style="color:#F0F3F6;">(</span></span>
<span class="line"><span style="color:#F0F3F6;">                    profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span></span>
<span class="line"><span style="color:#BDC4CC;">            // We cannot use Profiles.of(...) since profile expressions are not supported</span></span>
<span class="line"><span style="color:#BDC4CC;">            // in XML config. See SPR-12458 for details.</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (</span><span style="color:#FF9492;">!</span><span style="color:#DBB7FF;">getReaderContext</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getEnvironment</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">acceptsProfiles</span><span style="color:#F0F3F6;">(specifiedProfiles)) {</span></span>
<span class="line"><span style="color:#FF9492;">                if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isDebugEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                    logger.</span><span style="color:#DBB7FF;">debug</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> profileSpec </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                            &quot;] not matching: &quot;</span><span style="color:#FF9492;"> +</span><span style="color:#DBB7FF;"> getReaderContext</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getResource</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">                }</span></span>
<span class="line"><span style="color:#FF9492;">                return</span><span style="color:#F0F3F6;">;</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBB7FF;">    preProcessXml</span><span style="color:#F0F3F6;">(root);</span></span>
<span class="line"><span style="color:#DBB7FF;">    parseBeanDefinitions</span><span style="color:#F0F3F6;">(root, </span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.delegate); </span><span style="color:#BDC4CC;">// 从Document的根元素开始进行Bean定义的Document对象  </span></span>
<span class="line"><span style="color:#DBB7FF;">    postProcessXml</span><span style="color:#F0F3F6;">(root);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#91CBFF;">    this</span><span style="color:#F0F3F6;">.delegate </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> parent;</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h4 id="beandefinitionparserdelegate解析bean定义资源文件生成beandefinition" tabindex="-1"><a class="header-anchor" href="#beandefinitionparserdelegate解析bean定义资源文件生成beandefinition"><span>BeanDefinitionParserDelegate解析Bean定义资源文件生成BeanDefinition</span></a></h4><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">/**</span></span>
<span class="line"><span style="color:#BDC4CC;">    * Parse the elements at the root level in the document:</span></span>
<span class="line"><span style="color:#BDC4CC;">    * &quot;import&quot;, &quot;alias&quot;, &quot;bean&quot;.</span></span>
<span class="line"><span style="color:#BDC4CC;">    * </span><span style="color:#FF9492;">@param</span><span style="color:#FFB757;"> root</span><span style="color:#BDC4CC;"> the DOM root element of the document</span></span>
<span class="line"><span style="color:#BDC4CC;">    */</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> parseBeanDefinitions</span><span style="color:#F0F3F6;">(Element root, BeanDefinitionParserDelegate delegate) {</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">isDefaultNamespace</span><span style="color:#F0F3F6;">(root)) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        NodeList</span><span style="color:#F0F3F6;"> nl</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> root.</span><span style="color:#DBB7FF;">getChildNodes</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">        for</span><span style="color:#F0F3F6;"> (</span><span style="color:#FF9492;">int</span><span style="color:#F0F3F6;"> i</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> 0</span><span style="color:#F0F3F6;">; i </span><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;"> nl.</span><span style="color:#DBB7FF;">getLength</span><span style="color:#F0F3F6;">(); i</span><span style="color:#FF9492;">++</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">            Node</span><span style="color:#F0F3F6;"> node</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> nl.</span><span style="color:#DBB7FF;">item</span><span style="color:#F0F3F6;">(i);</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (node </span><span style="color:#FF9492;">instanceof</span><span style="color:#F0F3F6;"> Element) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                Element</span><span style="color:#F0F3F6;"> ele</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> (Element) node;</span></span>
<span class="line"><span style="color:#FF9492;">                if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">isDefaultNamespace</span><span style="color:#F0F3F6;">(ele)) {</span></span>
<span class="line"><span style="color:#DBB7FF;">                    parseDefaultElement</span><span style="color:#F0F3F6;">(ele, delegate);</span></span>
<span class="line"><span style="color:#F0F3F6;">                }</span></span>
<span class="line"><span style="color:#FF9492;">                else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#F0F3F6;">                    delegate.</span><span style="color:#DBB7FF;">parseCustomElement</span><span style="color:#F0F3F6;">(ele);</span></span>
<span class="line"><span style="color:#F0F3F6;">                }</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#F0F3F6;">        delegate.</span><span style="color:#DBB7FF;">parseCustomElement</span><span style="color:#F0F3F6;">(root);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">private</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> parseDefaultElement</span><span style="color:#F0F3F6;">(Element ele, BeanDefinitionParserDelegate delegate) {</span></span>
<span class="line"><span style="color:#F0F3F6;">      </span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果元素节点是&lt;Import&gt;导入元素，进行导入解析</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">nodeNameEquals</span><span style="color:#F0F3F6;">(ele, IMPORT_ELEMENT)) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        importBeanDefinitionResource</span><span style="color:#F0F3F6;">(ele);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果元素节点是&lt;Alias&gt;别名元素，进行别名解析 </span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">nodeNameEquals</span><span style="color:#F0F3F6;">(ele, ALIAS_ELEMENT)) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        processAliasRegistration</span><span style="color:#F0F3F6;">(ele);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果元素节点&lt;Bean&gt;元素, 按照Spring的Bean规则解析元素  </span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">nodeNameEquals</span><span style="color:#F0F3F6;">(ele, BEAN_ELEMENT)) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        processBeanDefinition</span><span style="color:#F0F3F6;">(ele, delegate);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果元素节点&lt;Beans&gt;元素，即它是嵌套类型的</span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (delegate.</span><span style="color:#DBB7FF;">nodeNameEquals</span><span style="color:#F0F3F6;">(ele, NESTED_BEANS_ELEMENT)) {</span></span>
<span class="line"><span style="color:#BDC4CC;">        // 递归解析</span></span>
<span class="line"><span style="color:#DBB7FF;">        doRegisterBeanDefinitions</span><span style="color:#F0F3F6;">(ele);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>解析<code>Bean</code>生成<code>BeanDefinitionHolder</code>的方法</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">/**</span></span>
<span class="line"><span style="color:#BDC4CC;">    * Process the given bean element, parsing the bean definition</span></span>
<span class="line"><span style="color:#BDC4CC;">    * and registering it with the registry.</span></span>
<span class="line"><span style="color:#BDC4CC;">    */</span></span>
<span class="line"><span style="color:#FF9492;">protected</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> processBeanDefinition</span><span style="color:#F0F3F6;">(Element ele, BeanDefinitionParserDelegate delegate) {</span></span>
<span class="line"><span style="color:#F0F3F6;">    BeanDefinitionHolder</span><span style="color:#F0F3F6;"> bdHolder</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> delegate.</span><span style="color:#DBB7FF;">parseBeanDefinitionElement</span><span style="color:#F0F3F6;">(ele);</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (bdHolder </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#F0F3F6;">        bdHolder </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> delegate.</span><span style="color:#DBB7FF;">decorateBeanDefinitionIfRequired</span><span style="color:#F0F3F6;">(ele, bdHolder);</span></span>
<span class="line"><span style="color:#FF9492;">        try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // 注册最终的装饰实例</span></span>
<span class="line"><span style="color:#F0F3F6;">            BeanDefinitionReaderUtils.</span><span style="color:#DBB7FF;">registerBeanDefinition</span><span style="color:#F0F3F6;">(bdHolder, </span><span style="color:#DBB7FF;">getReaderContext</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">getRegistry</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        catch</span><span style="color:#F0F3F6;"> (BeanDefinitionStoreException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#DBB7FF;">            getReaderContext</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">error</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Failed to register bean definition with name &#39;&quot;</span><span style="color:#FF9492;"> +</span></span>
<span class="line"><span style="color:#F0F3F6;">                    bdHolder.</span><span style="color:#DBB7FF;">getBeanName</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;&#39;&quot;</span><span style="color:#F0F3F6;">, ele, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#BDC4CC;">        // Send registration event.</span></span>
<span class="line"><span style="color:#DBB7FF;">        getReaderContext</span><span style="color:#F0F3F6;">().</span><span style="color:#DBB7FF;">fireComponentRegistered</span><span style="color:#F0F3F6;">(</span><span style="color:#FF9492;">new</span><span style="color:#DBB7FF;"> BeanComponentDefinition</span><span style="color:#F0F3F6;">(bdHolder));</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><h4 id="解析过后的beandefinition在ioc容器中的注册" tabindex="-1"><a class="header-anchor" href="#解析过后的beandefinition在ioc容器中的注册"><span>解析过后的BeanDefinition在IoC容器中的注册</span></a></h4><p><code>Document</code>对象的解析后得到封装<code>BeanDefinition</code>的<code>BeanDefinitionHold</code>对象，然后调用<code>BeanDefinitionReaderUtils</code>的<code>registerBeanDefinition</code>方法向 IoC 容器注册解析的<code>Bean</code>，<code>BeanDefinitionReaderUtils</code>的注册的源码如下：</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">// 通过BeanDefinitionRegistry将BeanDefinitionHolder注册到BeanFactory</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> static</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> registerBeanDefinition</span><span style="color:#F0F3F6;">(</span></span>
<span class="line"><span style="color:#F0F3F6;">        BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span>
<span class="line"><span style="color:#F0F3F6;">        throws BeanDefinitionStoreException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // Register bean definition under primary name.</span></span>
<span class="line"><span style="color:#F0F3F6;">    String</span><span style="color:#F0F3F6;"> beanName</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> definitionHolder.</span><span style="color:#DBB7FF;">getBeanName</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">    registry.</span><span style="color:#DBB7FF;">registerBeanDefinition</span><span style="color:#F0F3F6;">(beanName, definitionHolder.</span><span style="color:#DBB7FF;">getBeanDefinition</span><span style="color:#F0F3F6;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">    // Register aliases for bean name, if any.</span></span>
<span class="line"><span style="color:#FF9492;">    String</span><span style="color:#FFB757;">[] </span><span style="color:#F0F3F6;">aliases</span><span style="color:#FF9492;"> =</span><span style="color:#F0F3F6;"> definitionHolder.</span><span style="color:#DBB7FF;">getAliases</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (aliases </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">        for</span><span style="color:#F0F3F6;"> (String</span><span style="color:#F0F3F6;"> alias</span><span style="color:#FF9492;"> :</span><span style="color:#F0F3F6;"> aliases) {</span></span>
<span class="line"><span style="color:#F0F3F6;">            registry.</span><span style="color:#DBB7FF;">registerAlias</span><span style="color:#F0F3F6;">(beanName, alias);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>当调用<code>BeanDefinitionReaderUtils</code>向 IoC 容器注册解析的<code>BeanDefinition</code>时，真正完成注册功能的是<code>DefaultListableBeanFactory</code>。</p><h4 id="defaultlistablebeanfactory向ioc容器注册解析后的beandefinition" tabindex="-1"><a class="header-anchor" href="#defaultlistablebeanfactory向ioc容器注册解析后的beandefinition"><span>DefaultListableBeanFactory向IoC容器注册解析后的BeanDefinition</span></a></h4><p>IOC 容器本质上就是一个<code>beanDefinitionMap</code>， 注册即将<code>BeanDefinition put</code>到<code>map</code>中。</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#0a0c10;color:#f0f3f6;"><pre class="shiki github-dark-high-contrast vp-code"><code><span class="line"><span style="color:#BDC4CC;">/** Map of bean definition objects, keyed by bean name. */</span></span>
<span class="line"><span style="color:#FF9492;">private</span><span style="color:#FF9492;"> final</span><span style="color:#F0F3F6;"> Map</span><span style="color:#FFB757;">&lt;</span><span style="color:#FF9492;">String</span><span style="color:#FFB757;">, </span><span style="color:#FF9492;">BeanDefinition</span><span style="color:#FFB757;">&gt; </span><span style="color:#F0F3F6;">beanDefinitionMap</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#F0F3F6;"> ConcurrentHashMap&lt;&gt;(</span><span style="color:#91CBFF;">256</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BDC4CC;">/** Map from bean name to merged BeanDefinitionHolder. */</span></span>
<span class="line"><span style="color:#FF9492;">private</span><span style="color:#FF9492;"> final</span><span style="color:#F0F3F6;"> Map</span><span style="color:#FFB757;">&lt;</span><span style="color:#FF9492;">String</span><span style="color:#FFB757;">, </span><span style="color:#FF9492;">BeanDefinitionHolder</span><span style="color:#FFB757;">&gt; </span><span style="color:#F0F3F6;">mergedBeanDefinitionHolders</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#F0F3F6;"> ConcurrentHashMap&lt;&gt;(</span><span style="color:#91CBFF;">256</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">@</span><span style="color:#FF9492;">Override</span></span>
<span class="line"><span style="color:#FF9492;">public</span><span style="color:#FF9492;"> void</span><span style="color:#DBB7FF;"> registerBeanDefinition</span><span style="color:#F0F3F6;">(String beanName, BeanDefinition beanDefinition)</span></span>
<span class="line"><span style="color:#F0F3F6;">        throws BeanDefinitionStoreException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">    Assert.</span><span style="color:#DBB7FF;">hasText</span><span style="color:#F0F3F6;">(beanName, </span><span style="color:#ADDCFF;">&quot;Bean name must not be empty&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">    Assert.</span><span style="color:#DBB7FF;">notNull</span><span style="color:#F0F3F6;">(beanDefinition, </span><span style="color:#ADDCFF;">&quot;BeanDefinition must not be null&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (beanDefinition </span><span style="color:#FF9492;">instanceof</span><span style="color:#F0F3F6;"> AbstractBeanDefinition) {</span></span>
<span class="line"><span style="color:#FF9492;">        try</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#F0F3F6;">            ((AbstractBeanDefinition) beanDefinition).</span><span style="color:#DBB7FF;">validate</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        catch</span><span style="color:#F0F3F6;"> (BeanDefinitionValidationException </span><span style="color:#FFB757;">ex</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#FF9492;">            throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionStoreException</span><span style="color:#F0F3F6;">(beanDefinition.</span><span style="color:#DBB7FF;">getResourceDescription</span><span style="color:#F0F3F6;">(), beanName,</span></span>
<span class="line"><span style="color:#ADDCFF;">                    &quot;Validation of bean definition failed&quot;</span><span style="color:#F0F3F6;">, ex);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F0F3F6;">    BeanDefinition</span><span style="color:#F0F3F6;"> existingDefinition</span><span style="color:#FF9492;"> =</span><span style="color:#91CBFF;"> this</span><span style="color:#F0F3F6;">.beanDefinitionMap.</span><span style="color:#DBB7FF;">get</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#BDC4CC;">    // 如果已经注册</span></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (existingDefinition </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">) {</span></span>
<span class="line"><span style="color:#BDC4CC;">        // 检查是否可以覆盖</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (</span><span style="color:#FF9492;">!</span><span style="color:#DBB7FF;">isAllowBeanDefinitionOverriding</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#FF9492;">            throw</span><span style="color:#FF9492;"> new</span><span style="color:#DBB7FF;"> BeanDefinitionOverrideException</span><span style="color:#F0F3F6;">(beanName, beanDefinition, existingDefinition);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (existingDefinition.</span><span style="color:#DBB7FF;">getRole</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">&lt;</span><span style="color:#F0F3F6;"> beanDefinition.</span><span style="color:#DBB7FF;">getRole</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isInfoEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                logger.</span><span style="color:#DBB7FF;">info</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Overriding user-defined bean definition for bean &#39;&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanName </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;&#39; with a framework-generated bean definition: replacing [&quot;</span><span style="color:#FF9492;"> +</span></span>
<span class="line"><span style="color:#F0F3F6;">                        existingDefinition </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;] with [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanDefinition </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (</span><span style="color:#FF9492;">!</span><span style="color:#F0F3F6;">beanDefinition.</span><span style="color:#DBB7FF;">equals</span><span style="color:#F0F3F6;">(existingDefinition)) {</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isDebugEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                logger.</span><span style="color:#DBB7FF;">debug</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Overriding bean definition for bean &#39;&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanName </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;&#39; with a different definition: replacing [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> existingDefinition </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;] with [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanDefinition </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#FF9492;">            if</span><span style="color:#F0F3F6;"> (logger.</span><span style="color:#DBB7FF;">isTraceEnabled</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#F0F3F6;">                logger.</span><span style="color:#DBB7FF;">trace</span><span style="color:#F0F3F6;">(</span><span style="color:#ADDCFF;">&quot;Overriding bean definition for bean &#39;&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanName </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;&#39; with an equivalent definition: replacing [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> existingDefinition </span><span style="color:#FF9492;">+</span></span>
<span class="line"><span style="color:#ADDCFF;">                        &quot;] with [&quot;</span><span style="color:#FF9492;"> +</span><span style="color:#F0F3F6;"> beanDefinition </span><span style="color:#FF9492;">+</span><span style="color:#ADDCFF;"> &quot;]&quot;</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#BDC4CC;">        // 覆盖</span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.beanDefinitionMap.</span><span style="color:#DBB7FF;">put</span><span style="color:#F0F3F6;">(beanName, beanDefinition);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#FF9492;">        if</span><span style="color:#F0F3F6;"> (</span><span style="color:#DBB7FF;">hasBeanCreationStarted</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Cannot modify startup-time collection elements anymore (for stable iteration)</span></span>
<span class="line"><span style="color:#FF9492;">            synchronized</span><span style="color:#F0F3F6;"> (</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.beanDefinitionMap) {</span></span>
<span class="line"><span style="color:#91CBFF;">                this</span><span style="color:#F0F3F6;">.beanDefinitionMap.</span><span style="color:#DBB7FF;">put</span><span style="color:#F0F3F6;">(beanName, beanDefinition);</span></span>
<span class="line"><span style="color:#F0F3F6;">                List</span><span style="color:#FFB757;">&lt;</span><span style="color:#FF9492;">String</span><span style="color:#FFB757;">&gt; </span><span style="color:#F0F3F6;">updatedDefinitions</span><span style="color:#FF9492;"> =</span><span style="color:#FF9492;"> new</span><span style="color:#F0F3F6;"> ArrayList&lt;&gt;(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.beanDefinitionNames.</span><span style="color:#DBB7FF;">size</span><span style="color:#F0F3F6;">() </span><span style="color:#FF9492;">+</span><span style="color:#91CBFF;"> 1</span><span style="color:#F0F3F6;">);</span></span>
<span class="line"><span style="color:#F0F3F6;">                updatedDefinitions.</span><span style="color:#DBB7FF;">addAll</span><span style="color:#F0F3F6;">(</span><span style="color:#91CBFF;">this</span><span style="color:#F0F3F6;">.beanDefinitionNames);</span></span>
<span class="line"><span style="color:#F0F3F6;">                updatedDefinitions.</span><span style="color:#DBB7FF;">add</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#91CBFF;">                this</span><span style="color:#F0F3F6;">.beanDefinitionNames </span><span style="color:#FF9492;">=</span><span style="color:#F0F3F6;"> updatedDefinitions;</span></span>
<span class="line"><span style="color:#DBB7FF;">                removeManualSingletonName</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#F0F3F6;">            }</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#FF9492;">        else</span><span style="color:#F0F3F6;"> {</span></span>
<span class="line"><span style="color:#BDC4CC;">            // Still in startup registration phase</span></span>
<span class="line"><span style="color:#91CBFF;">            this</span><span style="color:#F0F3F6;">.beanDefinitionMap.</span><span style="color:#DBB7FF;">put</span><span style="color:#F0F3F6;">(beanName, beanDefinition);</span></span>
<span class="line"><span style="color:#91CBFF;">            this</span><span style="color:#F0F3F6;">.beanDefinitionNames.</span><span style="color:#DBB7FF;">add</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#DBB7FF;">            removeManualSingletonName</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#F0F3F6;">        }</span></span>
<span class="line"><span style="color:#BDC4CC;">        //重置所有已经注册过的BeanDefinition的缓存  </span></span>
<span class="line"><span style="color:#91CBFF;">        this</span><span style="color:#F0F3F6;">.frozenBeanDefinitionNames </span><span style="color:#FF9492;">=</span><span style="color:#91CBFF;"> null</span><span style="color:#F0F3F6;">;</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9492;">    if</span><span style="color:#F0F3F6;"> (existingDefinition </span><span style="color:#FF9492;">!=</span><span style="color:#91CBFF;"> null</span><span style="color:#FF9492;"> ||</span><span style="color:#DBB7FF;"> containsSingleton</span><span style="color:#F0F3F6;">(beanName)) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        resetBeanDefinition</span><span style="color:#F0F3F6;">(beanName);</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#FF9492;">    else</span><span style="color:#FF9492;"> if</span><span style="color:#F0F3F6;"> (</span><span style="color:#DBB7FF;">isConfigurationFrozen</span><span style="color:#F0F3F6;">()) {</span></span>
<span class="line"><span style="color:#DBB7FF;">        clearByTypeCache</span><span style="color:#F0F3F6;">();</span></span>
<span class="line"><span style="color:#F0F3F6;">    }</span></span>
<span class="line"><span style="color:#F0F3F6;">}</span></span></code></pre></div><p>至此，<code>Bean</code>定义资源文件中配置的<code>Bean</code>被解析过后，已经注册到 IoC 容器中，被容器管理起来，真正完成了 IoC 容器初始化所做的全部工作。现在 IoC 容器中已经建立了整个<code>Bean</code>的配置信息，这些<code>BeanDefinition</code>信息已经可以使用，并且可以被检索，IoC 容器的作用就是对这些注册的<code>Bean</code>定义信息进行处理和维护。这些的注册的<code>Bean</code>定义信息是 IoC 容器控制反转的基础，正是有了这些注册的数据，容器才可以进行依赖注入。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><figure><img src="/wsq-blog/assets/spring-framework-ioc-source-9-D2_Itg6j.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>现在通过上面的代码，总结一下IOC容器初始化的基本步骤：</p><ul><li>初始化的入口在容器实现中的<code>refresh()</code>调用来完成</li><li>对<code>bean</code>定义载入 IOC 容器使用的方法是<code>loadBeanDefinition</code>，其中的大致过程如下：</li><li>通过<code>ResourceLoader</code>来完成资源文件位置的定位，<code>DefaultResourceLoader</code>是默认的实现，同时上下文本身就给出了<code>ResourceLoader</code>的实现，可以从类路径，文件系统, URL 等方式来定为资源位置。如果是<code>XmlBeanFactory</code>作为 IOC 容器，那么需要为它指定<code>bean</code>定义的资源，也就是说<code>bean</code>定义文件时通过抽象成<code>Resource</code>来被 IOC 容器处理的</li><li>通过<code>BeanDefinitionReader</code>来完成定义信息的解析和<code>Bean</code>信息的注册, 往往使用的是<code>XmlBeanDefinitionReader</code>来解析<code>bean</code>的<code>xml</code>定义文件 - 实际的处理过程是委托给<code>BeanDefinitionParserDelegate</code>来完成的，从而得到<code>bean</code>的定义信息，这些信息在 Spring 中使用<code>BeanDefinition</code>对象来表示 - 这个名字可以让我们想到<code>loadBeanDefinition</code>,<code>RegisterBeanDefinition</code>这些相关的方法 - 他们都是为处理<code>BeanDefinition</code>服务的</li><li>容器解析得到<code>BeanDefinition</code>以后，需要把它在 IOC 容器中注册，这由 IOC 实现<code>BeanDefinitionRegistry</code>接口来实现。注册过程就是在 IOC 容器内部维护的一个<code>HashMap</code>来保存得到的<code>BeanDefinition</code>的过程。这个<code>HashMap</code>是 IoC 容器持有<code>bean</code>信息的场所，以后对<code>bean</code>的操作都是围绕这个<code>HashMap</code>来实现的</li><li>然后我们就可以通过<code>BeanFactory</code>和<code>ApplicationContext</code>来享受到 Spring IOC 的服务了,在使用 IOC 容器的时候，我们注意到除了少量粘合代码，绝大多数以正确 IoC 风格编写的应用程序代码完全不用关心如何到达工厂，因为容器将把这些对象与容器管理的其他对象钩在一起。基本的策略是把工厂放到已知的地方，最好是放在对预期使用的上下文有意义的地方，以及代码将实际需要访问工厂的地方。 Spring 本身提供了对声明式载入 web 应用程序用法的应用程序上下文,并将其存储在<code>ServletContext</code>中的框架实现。</li></ul></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/11/1 01:55:29</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 592786982@qq.com">WSQ</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html" aria-label="/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BIOC%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1.html</div></a><a class="route-link auto-link next" href="/wsq-blog/java/Spring/Spring%E8%AF%A6%E8%A7%A3%E2%80%94IOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B9%8BBean%E5%AE%9E%E4%BE%8B%E5%8C%96.html" aria-label="Spring为什么不能解决prototype作用域循环依赖？"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Spring为什么不能解决prototype作用域循环依赖？<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:none;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><!----></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/wsq-blog/assets/app-ByvFWdWZ.js" defer></script>
  </body>
</html>
