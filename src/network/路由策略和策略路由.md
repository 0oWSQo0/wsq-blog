---
title: 路由策略和策略路由
date: 2025-05-30
tags: network
categories: 计算机网络
order: 31
---

## 路由策略
路由策略应用在路由信息发布、接收、引入和设置路由属性中：
1. 控制路由的发布
   可通过路由策略对所要发布的路由信息进行过滤，只允许发布满足条件的路由信息。
2. 控制路由的接收
   可通过路由策略对接收到的路由信息进行过滤，只允许接收满足条件的路由信息。
3. 控制路由的引入
   可通过路由策略只引入满足条件的路由信息，并控制所引入的路由信息的某些属性，使其满足本路由协议的路由属性要求。
4. 设置路由的属性
   修改通过路由策略过滤的路由的属性，满足自身需要。

路由策略的工具主要包括`filter-policy`和`route-policy`。
### filter-policy
`filter-policy`主要应用在路由协议的进程中，可以调用`ACL、ip-prefix`等工具来匹配路由，用于控制对路由的发布或接收，只有通过该策略的路由才可以被发布或者接收，未通过策略的路由则被过滤掉。

在 IGP 和 BGP 协议中都能够使用，`filter-policy`分为`import`（入方向）和`export`（出方向）。

`import`主要影响路由器接收路由，影响自身路由表的变化， 适合于任何路由 协议，但 是不同类型的路由协议也是有差别的，如距离矢量协议(如 RIP) 与链路状态协议(如 OSPF 、 IS-IS) 利用 该工具实现路由的控制时，实现的效果也不太一样 。 由于距离矢量协议基于自 身路由表来通告，传递的是路由表信息，通过 filter-policy import 可以过滤路由的接收。而 链路状态协议基于链路状态数据库的信息来通告，传递的是 LSA ，并不是路由信息。而 filter-policy import 不能过滤 112 类 LSA ， 而是阻止路由表的生成，该部分将在后续加以分析 。

`export`在距离矢量协议中用于向邻居发布路由时的控制，影响邻居路由器的路由表变 化 。 在链路状态协议中往往用于自治系统边界路由器上 ， 主要用来控制外部路由的引入。






### 路由策略原理
定义一组匹配规则，然后将匹配规则应用于路由信息，从而控制路由的发布、接收、引入等过程的策略中。在一个路由策略中，可以包含多组以`if-match`语句指定的匹配条件，这些匹配条件是以节点（`Node`）进行标识的。如果在一个路由策略中包含多个节点，会按照节点号从小到大依次匹配，直到与某节点的条件完全匹配，后面的节点就不再去匹配了。如果到了路由策略中最后一个节点仍没有匹配到，则该路由拒绝通过。




## 配置实例
### 策略路由配置
#### 实验拓扑
#### 实验要求
1. VLAN10 和 VLAN20 是企业内部的两个部门，当 R1 的两条连接到 Internet 的链路都正常时，企业内部不同网段地址的报文通过不同的链路连接到 Internet。
2. 当一条链路发生故障时，企业内部不同网段地址的报文都走无故障的链路，当故障恢复后，恢复报文从不同链路连接到 Internet。

| 设备 | 接口 | IP地址           |
|----|----|----------------|
| R1 |    | 192.168.1.1/24 |
|    |    | 192.168.2.1/24 |
|    |    | 192.168.3.1/24 |
|    |    | 192.168.4.1/24 |
| R2 |    | 192.168.3.2/24 |
|    |    | 192.168.5.2/24 |
| R3 |    | 192.168.4.2/24 |
|    |    | 192.168.6.2/24 |
| R4 |    | 192.168.5.1/24 |
|    |    | 192.168.6.1/24 |
|    |    | 192.168.7.1/24 |


#### 实验步骤


























