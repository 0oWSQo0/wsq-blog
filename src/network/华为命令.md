

## 常用检查命令
```shell
# 查看路由器上的路由表
display ip routing-table
# 查看路由器上的ARP表
display arp
# 查看设备的端口配置
display current-configuration | include port-group
# 查看设备的防火墙规则
display firewall configuration
# 使用ping测试域名解析
ping www.example.com
# 查看VLAN配置
display vlan
# 查看BGP邻居状态
display bgp peer
# 查看接口配置
display ip interface GigabitEthernet0/0/1
# 查看ACL规则
display acl 2000
# 检查链路聚合组（LAG）配置
display link-aggregation verbose
# 查看交换机的MAC地址表
display mac-address
# 查看ACL规则匹配日志，以检查是否有流量被ACL阻止
display acl log
# 查看链路状态
display interface brief
# 查看OSPF邻居状态
display ospf peer
```
## 系统视图相关命令

| 命令              | 说明 |
|-----------------|----|
| system-view     | 进入系统视图，这是配置设备的基础模式，可以进一步进入其他配置模式   |
| quit 或 exit     | 退出当前视图，返回上一级视图或退出配置模式   |
| save            | 保存当前配置到设备，确保设备重启后配置不会丢失   |
| display version | 显示设备的软件版本、硬件信息和启动配置文件等详细信息   |
| display device  | 显示设备的基本信息，如设备型号、序列号等   |


## 接口配置

| 命令                                           | 说明 |
|----------------------------------------------|---|
| interface [interface-type][interface-number] | 进入指定接口的配置视图，例如interface GigabitEthernet 0/0/1  |
| ip address [ip-address] [mask]               | 接口配置IP地址和子网掩码，例如ip address 192.168.1.1 24  |
| undo ip address                              | 取消接口的IP地址配置  |
| shutdown                                     | 关闭指定接口，停止其转发数据包  |
| undo shutdown                                | 启用之前关闭的接口  |
| display interface                            | 显示接口的状态信息，如链路状态、IP地址、MTU等  |

## 路由协议配置

| 命令                               | 说明 |
|----------------------------------|---|
| rip                              | 进入RIP（路由信息协议）配置视图  |
| network [network-address]        | 将网络加入到RIP广播中，例如network 192.168.1.0 |
| ospf                             | 进入OSPF（开放最短路径优先）配置视图  |
| area [area-id]                   | 进入OSPF区域配置视图，例如area 0  |
| network [network-address] [mask] | 在OSPF中配置网络，使其参与路由广播  |
| bgp                              | 进入BGP（边界网关协议）配置视图  |
| peer [ip-address]                | 配置BGP对等体，即与其他BGP路由器建立连接  |
| ipv4-family unicast              |  进入BGP IPv4单播配置视图  |
| network [network-address] [mask] | 在BGP中发布网络，使其在BGP自治系统中广播  |

## 网络安全配置

| 命令                                     | 说明 |
|----------------------------------------|---|
| user-interface [interface-number]      | 进入用户接口（如控制台、VTY等）的配置视图  |
| authentication-mode [mode]             | 设置用户接口的认证方式，如authentication-mode password  |
| set authentication password [password] | 设置用户接口的认证密码  |
| traffic-filter inbound                 | 进入入站流量过滤配置视图  |
| traffic-filter outbound                | 进入出站流量过滤配置视图  |
| firewall interzone [zone1] [zone2]     | 配置防火墙区域间策略，用于控制不同安全区域间的流量  |
| ipsec proposal [proposal-name]         | 进入IPSec加密提案配置视图  |
| ike proposal [proposal-name]           | 进入IKE（Internet密钥交换）提案配置视图  |

## 服务质量（QoS）配置

| 命令             | 说明 |
|----------------|---|
| qos            | 进入QoS配置视图  |
| queue          | 进入队列配置视图，用于配置接口的队列策略  |
| priority       | 设置队列的优先级，以确保关键业务流量的传输  |
| car            | 进入流量监管（CAR）配置视图，用于限制流量的速率  |
| mls qos map    | 进入QoS映射配置视图，用于定义流量的优先级和服务类型  |
| mls qos police | 进入QoS策略配置视图，用于对流量进行监管和标记  |

## 系统监控和诊断

| 命令                               | 说明 |
|----------------------------------|---|
| display interface description    | 显示接口的描述信息，包括物理状态和配置状态  |
| display interface brief          | 显示接口的简要信息，包括链路状态和协议状态  |
| display transceiver              | 显示光模块的状态信息，如型号、温度、功率等  |
| display link-aggregation summary | 显示聚合链路的状态信息，如聚合成员和负载均衡情况  |
| display logbuffer                | 显示设备的日志缓冲区内容，包括系统事件和错误信息  |

## 网络服务配置

| 命令                               | 说明 |
|----------------------------------|---|
| dhcp enable                      | 启用设备的DHCP服务，为网络中的设备自动分配IP地址 |
| dhcp server ip-pool [pool-name]  | 进入DHCP地址池配置视图，创建和管理IP地址池 |
| network [network-address] [mask] | 在DHCP服务中配置网络地址和子网掩码  |
| gateway-list [ip-address]        | 为DHCP客户端配置默认网关  |
| dns-list [ip-address]            | 为DHCP客户端配置DNS服务器地址  |
| snmp-agent                       | 进入SNMP代理配置视图，用于监控和管理网络设备  |
| syslog-service                   | 进入日志服务配置视图，用于配置日志服务器和日志级别  |
| radius                           | 进入RADIUS配置视图，用于集中管理用户认证和授权  |

## 帮助提示
### 完全帮助
当用户输入命令时，可以使用命令行的完全帮助获取全部关键字和参数的提示。

在任一命令视图下，键入`?`获取该命令视图下所有的命令及其简单描述。
```shell
<HUAWEI> ?
User view commands:
  backup         Backup electronic elabel
  cd             Change current directory
  check          Check information
  clear          Clear information
  clock          Specify the system clock
  compare        Compare function
...
```
键入一条命令的部分关键字，后接以空格分隔的`?`，如果该位置为关键字，则列出全部关键字及其简单描述。
```shell
<HUAWEI> system-view
[HUAWEI] ftp timeout ?
  INTEGER<1-35791>  The value of FTP timeout, the default value is 30 minutes
[HUAWEI] ftp timeout 35 ?
  <cr>

[HUAWEI] ftp timeout 35
```
其中，`INTEGER<1-35791>`是参数取值的说明，`The value of FTP timeout, the default value is 30 minutes`是对参数作用的简单描述。
### 部分帮助
当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符，可以使用命令行的部分帮助获取以该字符串开头的所有关键字的提示。

键入一字符串，其后紧接`?`，列出以该字符串开头的所有关键字。
```shell
<HUAWEI> d?
  debugging                               delete
  dir                                     display
<HUAWEI> d
```
键入一条命令，后接一字符串紧接`?`，列出命令以该字符串开头的所有关键字。
```shell
<HUAWEI> display b?
  bpdu                                    bridge
  buffer
```
输入命令的某个关键字的前几个字母，按下`tab`键，可以显示出完整的关键字，前提是这几个字母可以唯一标示出该关键字，否则，连续按下`tab`键，可出现不同的关键字，用户可以从中选择所需要的关键字。


## 端口镜像
镜像的分类:
* 基于端口的镜像：端口镜像就是将被监控端口上的数据复制到指定的监控端口，对数据进行分析和监视。
* 基于流的镜像：流镜像就是将匹配访问控制列表的业务流复制到指定的监控端口，用于报文的分析和监视。

### 基于端口的镜像


#### 配置本地端口镜像
```shell
[SW] observe-port 1 interface gigabitethernet0/0/3
[SW] interfae gigabitethernet0/0/2
[SW-gigabitethernet0/0/2] port-mirroring to observe-port 1 both
```


## 路由策略
### route-policy
```shell
[Huawei]route-policy name {permit|deny} node node-name
```
默认情况下，所有未匹配的路由将拒绝通过`route-policy`。如果`route-policy`中定义了一个以上的节点，则各节点中至少应该有一个节点的匹配模式为`permit`。

[](华为命令/route-policy.png)

R1的配置：
```shell
# 定义一个 acl2000，用于匹配需要放行的路由
[R1]acl 2000
[R1-acl-basic-2000]rule permit source 172.16.1.0 0.0.0.0
[R1-acl-basic-2000]quit
# 创建-个route-policy,名字叫RP,同时配置第一个节点,节点编号为10
[R1]route-policy RP permit node 10
Info: New Sequence of this List.
[R1-route-policy]if-match ?
  acl                  Specify an ACL
  as-path-filter       BGP AS path list
  community-filter     Match BGP community filter
  cost                 Match metric of route
  extcommunity-filter  Match BGP/VPN extended community filter
  interface            Specify the interface matching the first hop of routes
  ip                   IP information
  ip-prefix            Specify an address prefix-list
  ipv6                 IPv6 Information
  mpls-label           Give the Label
  rd-filter            Route-distinguisher filter
  route-type           Match route-type of route
  tag                  Match tag of route
# 在节点10中，定义了一个if-match子句，调用acl2000
[R1-route-policy]if-match acl 2000
[R1-route-policy]apply ?
  as-path           BGP AS path list
  backup-interface  Backup outgoing interface
  backup-nexthop    Backup nexthop address
  behavior          Specify QoS policy as behavior
  comm-filter       Set BGP community filter (for deletion)
  community         BGP community attribute
  cost              Set metric of route
  cost-type         Type of metric for destination routing protocol
  dampening         Set BGP route flap dampening parameters
  extcommunity      Set BGP/VPN extended community filter
  ip-address        IP information
  ip-precedence     Specify QoS policy as IP precedence
  ipv6              IPv6 Information
  isis              Where to import route
  local-preference  BGP local preference path attribute
  mpls-label        Give the Label
  origin            BGP origin code
  ospf              Where to import route
  preference        Give the Preference  (Route Preference)
  preferred-value   BGP Preferred-value (weight) for routing table
  qos-local-id      Specify QoS policy as qos local id
  tag               Set tag of route
  traffic-index     Specify BGP Traffic Accounting Index

# 在节点10中，定义了一个apply子句，设置cost值为20
[R1-route-policy]apply cost 20
[R1-route-policy]quit
[R1]ospf 1
# 在ospf中注入直连路由的时候调用这个route-policy
[R1-ospf-1]import-route direct route-policy RP

```

## VRRP

[](华为命令/vrrp-default.png)
```shell
[R1]interface GigabitEthernet0/0/0
[R1-GigabitEthernet0/0/0]ip address 192.168.1.253 24
[R1-GigabitEthernet0/0/0]vrrp vrid 1 ?
  authentication-mode  Specify password and authentication mode
  preempt-mode         Specify preempt mode
  priority             Specify priority
  timer                Specify timer
  track                Specify the track configuration
  version-3            Specify the device to support V3 for VRRP
  virtual-ip           Specify virtual IP address
# 激活接口VRRP，加入VRRP组（VRID为1），虚拟IP为192.168.1.254
[R1-GigabitEthernet0/0/0]vrrp vrid 1 virtual-ip 192.168.1.254
# 该接口在该VRRP组中的优先级为120（优先级值默认为100）
[R1-GigabitEthernet0/0/0]vrrp vrid 1 priority 120
[R1-GigabitEthernet0/0/0]vrrp vrid 1 preempt-mode timer ?
  delay  Specify interval of delay
# 配置虚拟路由器的抢占时间为20s
# 抢占时间是指当主设备因为故障修复重新切换为主状态时等待的时间
[R1-GigabitEthernet0/0/0]vrrp vrid 1 preempt-mode timer delay 20
```
```shell
[R2]interface GigabitEthernet 0/0/0
[R2-GigabitEthernet0/0/0]ip address 192.168.1.252 24
[R2-GigabitEthernet0/0/0]vrrp vrid 1 virtual-ip 192.168.1.254
```
查看结果：
```shell
[R1-GigabitEthernet0/0/0]display vrrp ?
  INTEGER<1-255>        Virtual router identifier
  brief                 Summary information
  interface             Specify the interface
  protocol-information  Protocol information of VRRP
  state-change          State change track
  statistics            Statistics about VRRP packets
  |                     Matching output
  <cr>                  Please press ENTER to execute command 
[R1-GigabitEthernet0/0/0]display vrrp
  GigabitEthernet0/0/0 | Virtual Router 1
    State : Master
    Virtual IP : 192.168.1.254
    Master IP : 192.168.1.253
    PriorityRun : 120
    PriorityConfig : 120
    MasterPriority : 120
    Preempt : YES   Delay Time : 20 s
    TimerRun : 1 s
    TimerConfig : 1 s
    Auth type : NONE
    Virtual MAC : 0000-5e00-0101
    Check TTL : YES
    Config type : normal-vrrp
    Backup-forward : disabled
    Create time : 2025-04-17 14:06:16 UTC-08:00
    Last change time : 2025-04-17 14:06:20 UTC-08:00
    
[R1-GigabitEthernet0/0/0]display vrrp brief
Total:1     Master:1     Backup:0     Non-active:0      
VRID  State        Interface                Type     Virtual IP     
----------------------------------------------------------------
1     Master       GE0/0/0                  Normal   192.168.1.254 
```
```shell
[R2-GigabitEthernet0/0/0]display vrrp
  GigabitEthernet0/0/0 | Virtual Router 1
    State : Backup
    Virtual IP : 192.168.1.254
    Master IP : 192.168.1.253
    PriorityRun : 100
    PriorityConfig : 100
    MasterPriority : 120
    Preempt : YES   Delay Time : 0 s
    TimerRun : 1 s
    TimerConfig : 1 s
    Auth type : NONE
    Virtual MAC : 0000-5e00-0101
    Check TTL : YES
    Config type : normal-vrrp
    Backup-forward : disabled
    Create time : 2025-04-17 14:13:58 UTC-08:00
    Last change time : 2025-04-17 14:13:58 UTC-08:00

[R2-GigabitEthernet0/0/0]display vrrp brief 
Total:1     Master:0     Backup:1     Non-active:0      
VRID  State        Interface                Type     Virtual IP     
----------------------------------------------------------------
1     Backup       GE0/0/0                  Normal   192.168.1.254
```
### track接口状态

[](华为命令/vrrp-track.png)

Backup 路由器会不断侦听 Master 发出来的 VRRP 报文以便判断它的存活状态，当 Master 路由器发生故障时，Backup 路由器能够感知并且进行切换。但是如果 Master 路由器没有发生整机故障，而只是其上行接口故障了呢?例如上图中，R1 作为 Master 路由器，如果其 GE0/0/1口 DOWN 掉了，那么用户的上行流量被引导到 R1 后，将会被丢弃。

VRRP 有一个特性可以解决这个问题：通过在 R1 上部署 VRRP track，使其能够跟踪 GE0/0/1的状态，如果 GE0/0/1 的物理状态或者协议状态变为 Down，那么 R1 就会主动将自己的 GE0/0/0 接口 VRRP 优先级减去一个值 从而使得 R2 的优先级值更大、优先级更高，那么 R2 将成为新的 Master R1 则成为 Backup，用户发往默认网关的上行流量便会被引导到 R2。

```shell
[R1]interface GigabitEthernet 0/0/0
[R1-GigabitEthernet0/0/0]ip address 192.168.1.253 24
# 激活接口VRRP，加入VRRP组（VRID为1），虚拟IP为192.168.1.254
[R1-GigabitEthernet0/0/0]vrrp vrid 1 virtual-ip 192.168.1.254
# 该接口在该VRRP组中的优先级为120（优先级值默认为100）
[R1-GigabitEthernet0/0/0]vrrp vrid 1 priority 120
[R1-GigabitEthernet0/0/0]vrrp vrid 1 track ?
  bfd-session  Specify BFD session
  interface    Interface information
  ip           Specify IP protocol
  nqa          Specify NQA test class
[R1-GigabitEthernet0/0/0]vrrp vrid 1 track interface GigabitEthernet 0/0/1 ?
  increased  Increase priority
  reduced    Reduce priority
  <cr>       Please press ENTER to execute command 
[R1-GigabitEthernet0/0/0]vrrp vrid 1 track interface GigabitEthernet 0/0/1 reduced 30
# 配置虚拟路由器的抢占时间为20s
# 抢占时间是指当主设备因为故障修复重新切换为主状态时等待的时间
[R1-GigabitEthernet0/0/0]vrrp vrid 1 preempt-mode timer delay 20
```

## NAT
### NAT在路由器上的配置
#### 基于动态地址池的No-PAT
[](华为命令/nat-static.png)
在上图中，OR 是出口路由器，它连接着内网PC及 Internet。现在内网`192.168.1.0/24`网段的用户需要访问 Internet，该网络从运营商申请到的公网地址区间是`200.1.1.100-200.1.1.116`，完成基于地址池的`No-PAT`配置，使得内网用户能够访问 Internet。
```shell
# 定义NAT池，其标识为1，其中包括的公网地址范围是200.1.1.100-200.1.1.116
[OR]nat address-group 1 200.1.1.100 200.1.1.116
# 定义acl2000，用于匹配允许NAT的内网地址段192.168.1.0/24
[OR]acl 2000
[OR-acl-basic-2000]rule permit source 192.168.1.0 0.0.0.255
[OR-acl-basic-2000]quit
[OR]interface GigabitEthernet 0/0/1
[OR-GigabitEthernet0/0/1]nat outbound ?
  INTEGER<2000-3999>  Apply basic or advanced ACL

[OR-GigabitEthernet0/0/1]nat outbound 2000 address-group 1 ?
  no-pat  Not use PAT
  <cr>    Please press ENTER to execute command 

# 连接在外网的接口上应用基于地址池的No-PAT，将acl2000所匹配的报文与NAT地址池1进行绑定
[OR-GigabitEthernet0/0/1]nat outbound 2000 address-group 1 no-pat
[OR-GigabitEthernet0/0/1]quit
[OR]ip route-static 0.0.0.0 0.0.0.0 200.1.1.2
```

#### NAT Server
[](华为命令/nat-static.png)
在上图中，OR 是出口路由器，它连接着内网 Server 及 Internet。内网有一台 WEB 服务器`192.168.1.100`，其 TCP80 端口需要面向 Internet 提供服务,该网络从运营商申请到的公网地址是`200.1.1.30`，在路由器上完成 NAT Server 的配置，使得 Internet 用户能够通过访问`200.1.1.30:8080`，从而访问`192.168.1.100:80`。
```shell
[OR]interface GigabitEthernet 0/0/1
[OR-GigabitEthernet0/0/1]nat server ?
  global    Specify global information of NAT
  protocol  Specify protocol
[OR-GigabitEthernet0/0/1]nat server protocol ?
  <1-255>  Protocol number
  icmp     Internet Control Message Protocol (1)
  tcp      Transmission Control Protocol (6)
  udp      User Datagram Protocol (17)
[OR-GigabitEthernet0/0/1]nat server protocol tcp global 200.1.1.30 8080 inside 192.168.1.100 80
[OR]ip route-static 0.0.0.0 0.0.0.0 200.1.1.2
```
