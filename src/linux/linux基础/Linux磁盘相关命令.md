---
title: Linux磁盘相关命令
date: 2024-03-25
tags: linux基础
categories: linux
order: 11
---

## df：查看文件系统硬盘使用情况
`df`命令，用于显示 Linux 系统中各文件系统的硬盘使用情况，包括文件系统所在硬盘分区的总容量、已使用的容量、剩余容量等。

与整个文件系统有关的数据，都保存在`Super block`（超级块）中，而`df`命令主要读取的数据几乎都针对的是整个文件系统，所以`df`命令主要是从各文件系统的`Super block`中读取数据。
```bash
df [选项] [目录或文件名]
```

|    选项	    | 作用                                    |
|:---------:|:--------------------------------------|
| -a, --all | 显示所有文件系统信息，包括系统特有的 /proc、/sysfs 等文件系统 |
|    -m     | 以 MB 为单位显示容量                          |
|    -k     | 以 KB 为单位显示容量，默认以 KB 为单位               |
|    -h     | 使用人们习惯的 KB、MB 或 GB 等单位显示容量            |
|    -T     | 显示该分区的文件系统名称                          |


```bash
[root@localhost ~]# df
Filesystem      1K-blocks      Used Available Use% Mounted on
/dev/hdc2         9920624   3823112   5585444  41% /
/dev/hdc3         4956316    141376   4559108   4% /home
/dev/hdc1          101086     11126     84741  12% /boot
tmpfs              371332         0    371332   0% /dev/shm
```
不使用任何选项的`df`命令，默认会将系统内所有的文件系统信息，以`KB`为单位显示出来。

由`df`命令显示出的各列信息的含义分别是：
* `Filesystem`：表示该文件系统位于哪个分区，因此该列显示的是设备名称；
* `1K-blocks`：此列表示文件系统的总大小，默认以`KB`为单位；
* `Used`：表示用掉的硬盘空间大小；
* `Available`：表示剩余的硬盘空间大小；
* `Use%`：硬盘空间使用率。如果使用率高达 90% 以上，就需要额外注意，因为容量不足，会严重影响系统的正常运行；
* `Mounted on`：文件系统的挂载点，也就是硬盘挂载的目录位置。

```bash
[root@localhost ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/hdc2             9.5G  3.7G  5.4G  41% /
/dev/hdc3             4.8G  139M  4.4G   4% /home
/dev/hdc1              99M   11M   83M  12% /boot
tmpfs                 363M     0  363M   0% /dev/shm
```
```bash
[root@localhost ~]# df -h /etc
Filesystem            Size  Used Avail Use% Mounted on
/dev/hdc2             9.5G  3.7G  5.4G  41% /
```
这里在`df`命令后添加了目录名，在这种情况下，`df`命令会自动分析该目录所在的分区，并将所在分区的有关信息显示出来。由此，我们就可以知道，该目录下还可以使用多少容量。
```bash
[root@localhost ~]# df -aT
Filesystem    Type 1K-blocks    Used Available Use% Mounted on
/dev/hdc2     ext3   9920624 3823112   5585444  41% /
proc          proc         0       0         0   -  /proc
sysfs        sysfs         0       0         0   -  /sys
devpts      devpts         0       0         0   -  /dev/pts
/dev/hdc3     ext3   4956316  141376   4559108   4% /home
/dev/hdc1     ext3    101086   11126     84741  12% /boot
tmpfs        tmpfs    371332       0    371332   0% /dev/shm
none   binfmt_misc         0       0         0   -  /proc/sys/fs/binfmt_misc
sunrpc  rpc_pipefs         0       0         0   -  /var/lib/nfs/rpc_pipefs
```
注意，使用`-a`选项，会将很多特殊的文件系统显示出来，这些文件系统包含的大多是系统数据，存在于内存中，不会占用硬盘空间，因此你会看到，它们所占据的硬盘总容量为 0。
## du：统计目录或文件所占磁盘空间大小
`du`是统计目录或文件所占磁盘空间大小的命令。

需要注意的是，使用`ls -r`命令是可以看到文件的大小的。但是大家会发现，在使用`ls -r`命令査看目录大小时，目录的大小多数是`4KB`，这是因为目录下的子目录名和子文件名是保存到父目录的`block`（默认大小为 4KB）中的，如果父目录下的子目录和子文件并不多，一个`block`就能放下，那么这个父目录就只占用了一个`block`大小。

但是我们在统计目录时，不是想看父目录下的子目录名和子文件名到底占用了多少空间，而是想看父目录下的子目录和子文件的总磁盘占用量大小，这时就需要使用`du`命令才能统计目录的真正磁盘占用量大小。
```bash
du [选项] [目录或文件名]
```
选项：
* `-a`：显示每个子文件的磁盘占用量。默认只统计子目录的磁盘占用量
* `-h`：使用习惯单位显示磁盘占用量，如 KB、MB 或 GB 等
* `-s`：统计总磁盘占用量，而不列出子目录和子文件的磁盘占用量

```bash
[root@localhost ~]# du
#统计当前目录的总磁盘占用量大小，同时会统计当前目录下所有子目录的磁盘占用量大小，不统计子文件
#磁盘占用量的大小。默认单位为KB
20 ./.gnupg
#统计每个子目录的大小
24 ./yum.bak
8 ./dtest
28 ./sh
188
#统计当前目录总大小
```
```bash
[root@localhost ~]# du -a
#统计当前目录的总大小，同时会统计当前目录下所有子文件和子目录磁盘占用量的大小。默认单位为 KB

4 ./.bashjogout
36 ./install.log
4 ./.bash_profile
4 ./.cshrc
…省略部分输出…
188
```
```bash
[root@localhost ~]# du -sh
#只统计磁盘占用量总的大小，同时使用习惯单位显示
188K .
```
### du命令和df命令的区别
使用`du`命令和`df`命令去统计分区的使用情况时，得到的数据是不一样的。那是因为`df`命令是从文件系统的角度考虑的，通过文件系统中未分配的空间来确定文件系统中已经分配的空间大小。也就是说，在使用`df`命令统计分区时，不仅要考虑文件占用的空间，还要统计被命令或程序占用的空间（最常见的就是文件已经删除，但是程序并没有释放空间）。

而`du`命令是面向文件的，只会计算文件或目录占用的磁盘空间。也就是说，`df`命令统计的分区更准确，是真正的空闲空间。
## free
`free`命令用来显示系统内存状态，包括系统物理内存、虚拟内存（`swap` 换分区）、共享内存和系统缓存的使用情况，其输出和`top`命令的内存部分非常相似。
```shell
[root@localhost ~]# free [选项]
```

| 选项 | 含义                                   |
| :--: |:-------------------------------------|
| -h | 以合适的单位显示内存使用情况，最大为三位数，自动计算对应的单位值。 |
| -b | 以 Byte（字节）为单位，显示内存使用情况。              |
| -k | 以 KB 为单位，显示内存使用情况，此选项是 free 命令的默认选项。 |
| -m | 以 MB 为单位，显示内存使用情况。                   |
| -g | 以 GB 为单位，显示内存使用情况。                   |
| -t | 在输出的最终结果中，输出内存和 swap 分区的总量。          |
| -o | 不显示系统缓冲区这一列。                         |
| -s | 间隔秒数	根据指定的间隔时间，持续显示内存使用情况。           |

```shell
[root@localhost ~]# free -m
               total        used        free      shared  buff/cache   available
Mem:            1741         342        1372           5         175        1399
Swap:           2063           0        2063
```

第一行显示的是各个列的列表头信息，含义：
* `total`：总内存数
* `used`：已经使用的内存数
* `free`：空闲的内存数
* `shared`：多个进程共享的内存总数
* `buffers`：缓冲内存数
* `available`：可用缓存内存数

关系：`total = used +available`。

`Mem`一行指的是内存的使用情况；`Swap`一行指的就是`swap`分区的使用情况。

可以看到，系统的物理内存为 1741 MB，已经使用了 342 MB，空闲 1372 MB。而`swap`分区总大小为 2063 MB，目前尚未使用。

